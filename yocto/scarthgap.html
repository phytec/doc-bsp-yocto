

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. PHYTEC Documentation &mdash; PHYTEC BSP Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/code-block.css?v=7a82ee62" />
      <link rel="stylesheet" type="text/css" href="../_static/css/phytec-theme.css?v=82726be5" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://phytec.github.io/doc-bsp-yocto/yocto/scarthgap.html" />
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RAUC Update &amp; Device Management" href="../rauc/manual-index.html" />
    <link rel="prev" title="1. PHYTEC Documentation" href="mickledore.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PHYTEC BSP Documentation
              <img src="../_static/logo-phytec.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">BSP Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bsp/imx8/imx8.html">i.MX 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsp/imx9/imx9.html">i.MX 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsp/am6x/am6x.html">AM6X</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Yocto Manuals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="manual-index.html">Unstable (dev)</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-index.html#kirkstone">Kirkstone</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-index.html#mickledore">Mickledore</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="manual-index.html#scarthgap">Scarthgap</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">1. PHYTEC Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-yocto-project">2. The Yocto Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#yocto-introduction">2.1. Yocto Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-components">2.2. Core Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vocabulary">2.3. Vocabulary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#recipes">2.3.1. Recipes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classes">2.3.2. Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#layers">2.3.3. Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#machine">2.3.4. Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distribution-distro">2.3.5. Distribution (Distro)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#poky">2.4. Poky</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">2.4.1. Bitbake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.4.2. Toaster</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#official-documentation">2.5. Official Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compatible-linux-distributions">3. Compatible Linux Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#phytec-bsp-introduction">4. PHYTEC BSP Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bsp-structure">4.1. BSP Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bsp-management">4.1.1. BSP Management</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#phylinux">4.1.1.1. phyLinux</a></li>
<li class="toctree-l5"><a class="reference internal" href="#repo">4.1.1.2. Repo</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#bsp-metadata">4.1.2. BSP Metadata</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id3">4.1.2.1. Poky</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-openembedded">4.1.2.2. meta-openembedded</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-qt6">4.1.2.3. meta-qt6</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-nodejs">4.1.2.4. meta-nodejs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-gstreamer1-0">4.1.2.5. meta-gstreamer1.0</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-rauc">4.1.2.6. meta-rauc</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-phytec">4.1.2.7. meta-phytec</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-ampliphy">4.1.2.8. meta-ampliphy</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-qt6-phytec">4.1.2.9. meta-qt6-phytec</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-virtualization">4.1.2.10. meta-virtualization</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id4">4.1.2.11. meta-security</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-selinux">4.1.2.12. meta-selinux</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-browser">4.1.2.13. meta-browser</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-rust">4.1.2.14. meta-rust</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-timesys">4.1.2.15. meta-timesys</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-freescale">4.1.2.16. meta-freescale</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-freescale-3rdparty">4.1.2.17. meta-freescale-3rdparty</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-freescale-distro">4.1.2.18. meta-freescale-distro</a></li>
<li class="toctree-l5"><a class="reference internal" href="#base-fsl-community-bsp-base">4.1.2.19. base (fsl-community-bsp-base)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#meta-fsl-bsp-release">4.1.2.20. meta-fsl-bsp-release</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#bsp-content">4.1.3. BSP Content</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-configuration">4.2. Build Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pre-built-images">5. Pre-built Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bsp-workspace-installation">6. BSP Workspace Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-host">6.1. Setting Up the Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="#git-configuration">6.2. Git Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#site-conf-setup">6.3. site.conf Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#phylinux-documentation">7. phyLinux Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-phylinux">7.1. Get phyLinux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-usage">7.2. Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization">7.3. Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-usage">7.4. Advanced Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-build-container">8. Using build-container</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">8.1. Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-container">8.2. Available container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-pull-container">8.3. Download/Pull container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-container">8.4. Run container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-poky-and-bitbake">9. Working with Poky and Bitbake</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-the-build">9.1. Start the Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#images">9.2. Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-development-states-between-releases">9.3. Accessing the Development States between Releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inspect-your-build-configuration">9.4. Inspect your Build Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bsp-features-of-meta-phytec-and-meta-ampliphy">9.5. BSP Features of meta-phytec and meta-ampliphy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buildinfo">9.5.1. <em>Buildinfo</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bsp-customization">9.6. BSP Customization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#disable-qt-demo">9.6.1. Disable Qt Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#framebuffer-console">9.6.2. Framebuffer Console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tools-provided-in-the-prebuild-image">9.6.3. Tools Provided in the Prebuild Image</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#ram-benchmark">9.6.3.1. RAM Benchmark</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#add-additional-software-for-the-bsp-image">9.6.4. Add Additional Software for the BSP Image</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#notes-about-packages-and-recipes">9.6.4.1. Notes about Packages and Recipes</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#add-an-additional-layer">9.6.5. Add an Additional Layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-your-own-layer">9.6.6. Create your own layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kernel-and-bootloader-recipe-and-version">9.6.7. Kernel and Bootloader Recipe and Version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kernel-and-bootloader-configuration">9.6.8. Kernel and Bootloader Configuration</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#add-a-configuration-fragment-to-a-recipe">9.6.8.1. Add a Configuration Fragment to a Recipe</a></li>
<li class="toctree-l5"><a class="reference internal" href="#add-a-complete-default-configuration-defconfig-to-a-recipe">9.6.8.2. Add a Complete Default Configuration (<em>defconfig</em>) to a Recipe</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#patch-the-kernel-or-bootloader-with-devtool">9.6.9. Patch the Kernel or Bootloader with <em>devtool</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#patch-the-kernel-or-bootloader-using-the-temporary-method">9.6.10. Patch the Kernel or Bootloader using the “Temporary Method”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#working-with-the-kernel-and-bootloader-using-src-uri-in-local-conf">9.6.11. Working with the Kernel and Bootloader using SRC_URI in <em>local.conf</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-existing-software-with-sustainable-method">9.6.12. Add Existing Software with “Sustainable Method”</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-linux-firmware-files-to-the-root-filesystem">9.6.13. Add Linux Firmware Files to the Root Filesystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-the-u-boot-environment-via-bbappend-files">9.6.14. Change the <em>u-boot</em> Environment via <em>bbappend</em> Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-the-barebox-environment-via-bbappend-files">9.6.15. Change the <em>barebox</em> Environment via <em>bbappend</em> Files</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#debugging-the-environment">9.6.15.1. Debugging the Environment</a></li>
<li class="toctree-l5"><a class="reference internal" href="#changing-the-environment-depending-on-machines">9.6.15.2. Changing the Environment (depending on Machines)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#upgrading-the-barebox-environment-from-previous-bsp-releases">9.6.15.3. Upgrading the <em>barebox</em> Environment from Previous BSP Releases</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#changing-the-network-configuration">9.6.16. Changing the Network Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changing-the-wireless-network-configuration">9.6.17. Changing the Wireless Network Configuration</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#connecting-to-a-wlan-network">9.6.17.1. Connecting to a WLAN Network</a></li>
<li class="toctree-l5"><a class="reference internal" href="#creating-a-wlan-access-point">9.6.17.2. Creating a WLAN Access Point</a></li>
<li class="toctree-l5"><a class="reference internal" href="#phycore-i-mx-6ul-ull-bluetooth">9.6.17.3. phyCORE-i.MX 6UL/ULL Bluetooth</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#add-opencv-libraries-and-examples">9.6.18. Add OpenCV Libraries and Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-minimal-php-web-runtime-with-lightpd">9.6.19. Add Minimal PHP web runtime with <em>lightpd</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-tasks">9.7. Common Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debugging-a-user-space-application">9.7.1. Debugging a User Space Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generating-source-mirrors-working-offline">9.7.2. Generating Source Mirrors, working Offline</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-on-the-target">9.7.3. Compiling on the Target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#different-toolchains">9.7.4. Different Toolchains</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#using-the-sdk">9.7.4.1. Using the SDK</a></li>
<li class="toctree-l5"><a class="reference internal" href="#using-the-sdk-with-gnu-autotools">9.7.4.2. Using the SDK with GNU Autotools</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#working-with-kernel-modules">9.7.5. Working with Kernel Modules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">10. Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setscene-task-warning">10.1. Setscene Task Warning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#yocto-documentation">11. Yocto Documentation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rauc/manual-index.html">RAUC Update &amp; Device Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/manual-index.html">Security Manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coprocessor/index.html">Coprocessor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribute</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing_links.html">Contribute</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PHYTEC BSP Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="manual-index.html">Unstable (dev)</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>PHYTEC Documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/phytec/doc-bsp-yocto/blob/main/source/yocto/scarthgap.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>Documentation in pdf format: <a class="reference external" href="../_static/scarthgap.pdf">Download</a></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Yocto Reference Manual</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Document Title</p></td>
<td><p>Yocto Reference Manual Scarthgap</p></td>
</tr>
<tr class="row-odd"><td><p>Document Type</p></td>
<td><p>Yocto Manual</p></td>
</tr>
<tr class="row-even"><td><p>Release Date</p></td>
<td><p>XXXX/XX/XX</p></td>
</tr>
<tr class="row-odd"><td><p>Is Branch of</p></td>
<td><p>Yocto Reference Manual</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Compatible BSPs</p></th>
<th class="head"><p>BSP Release Type</p></th>
<th class="head"><p>BSP Release Date</p></th>
<th class="head"><p>BSP Status</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BSP-Yocto-Ampliphy-AM62Ax-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-06-27</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-odd"><td><p>BSP-Yocto-Ampliphy-AM62x-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-06-27</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-even"><td><p>BSP-Yocto-Ampliphy-AM64x-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-06-27</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-odd"><td><p>BSP-Yocto-Ampliphy-i.MX6-PD25.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-12-20</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-even"><td><p>BSP-Yocto-Ampliphy-i.MX6UL-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-07-19</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-odd"><td><p>BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-04-02</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-even"><td><p>BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.1</p></td>
<td><p>Minor</p></td>
<td><p>2024-04-09</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-odd"><td><p>BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.2</p></td>
<td><p>Minor</p></td>
<td><p>2024-06-26</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-even"><td><p>BSP-Yocto-NXP-i.MX8MP-PD24.1.0</p></td>
<td><p>Major</p></td>
<td><p>2024-11-07</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-odd"><td><p>BSP-Yocto-NXP-i.MX93-PD24.2.0</p></td>
<td><p>Major</p></td>
<td><p>2024-10-08</p></td>
<td><p>released</p></td>
</tr>
<tr class="row-even"><td><p>BSP-Yocto-NXP-i.MX95-ALPHA1</p></td>
<td><p>Alpha</p></td>
<td><p>2025-06-02</p></td>
<td><p>released</p></td>
</tr>
</tbody>
</table>
<p>This manual applies to all Scarthgap based PHYTEC releases.</p>
<section id="phytec-documentation">
<span id="yocto-man-scarthgap"></span><h1><span class="section-number">1. </span>PHYTEC Documentation<a class="headerlink" href="#phytec-documentation" title="Link to this heading"></a></h1>
<p>PHYTEC provides a variety of hardware and software documentation for
all of its products. This includes any or all of the following:</p>
<ul class="simple">
<li><p><strong>QS Guide</strong>: A short guide on how to set up and boot a phyCORE based
board.</p></li>
<li><p><strong>Hardware Manual</strong>: A detailed description of the System-on-Module and
accompanying carrierboard.</p></li>
<li><p><strong>Yocto Guide</strong>: A comprehensive guide for the Yocto version
the phyCORE uses. This guide contains an overview of Yocto;
introducing, installing, and customizing the PHYTEC BSP; how to
work with programs like Poky and Bitbake; and much more.</p></li>
<li><p><strong>BSP Manual</strong>: A manual specific to the BSP version of the phyCORE.
Information such as how to build the BSP, booting, updating
software, device tree, and accessing peripherals can be found
here.</p></li>
<li><p><strong>Development Environment Guide</strong>: This guide shows how to work
with the Virtual Machine (VM) Host PHYTEC has developed and
prepared to run various Development Environments. There are
detailed step-by-step instructions for Eclipse and Qt Creator,
which are included in the VM. There are instructions for running
demo projects for these programs on a phyCORE product as well.
Information on how to build a Linux host PC yourself is also a
part of this guide.</p></li>
<li><p><strong>Pin Muxing Table</strong>: phyCORE SOMs have an accompanying pin
table (in Excel format). This table will show the complete
default signal path, from the processor to the carrier board.
The default device tree muxing option will also be included.
This gives a developer all the information needed in one location
to make muxing changes and design options when developing a
specialized carrier board or adapting a PHYTEC phyCORE SOM to an
application.</p></li>
</ul>
<p>On top of these standard manuals and guides, PHYTEC will also provide Product
Change Notifications, Application Notes, and Technical Notes. These will be done
on a case-by-case basis. Most of the documentation can be found in the
applicable download page of our products.</p>
</section>
<section id="the-yocto-project">
<h1><span class="section-number">2. </span>The Yocto Project<a class="headerlink" href="#the-yocto-project" title="Link to this heading"></a></h1>
<section id="yocto-introduction">
<h2><span class="section-number">2.1. </span>Yocto Introduction<a class="headerlink" href="#yocto-introduction" title="Link to this heading"></a></h2>
<p>Yocto is the smallest SI metric system prefix. Like milli equates to <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">=</span>
<span class="pre">10^-3</span></code>, and so is yocto <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">10^-24</span></code>. Yocto is also a project working group
of the <a class="reference external" href="https://www.linuxfoundation.org/">Linux Foundation</a> and therefore
backed up by several major companies in the field. On the <a class="reference external" href="https://www.yoctoproject.org/">Yocto Project website</a> you can read the official introduction:</p>
<blockquote>
<div><p>The Yocto Project is an open-source collaboration project that provides
templates, tools, and methods to help you create custom Linux-based systems
for embedded products regardless of the hardware architecture. It was founded
in 2010 as a collaboration among many hardware manufacturers, open-source
operating systems vendors, and electronics companies to bring some order to
the chaos of embedded Linux development.</p>
</div></blockquote>
<p>As said, the project wants to provide toolsets for embedded developers. It
builds on top of the long-lasting <a class="reference external" href="https://www.openembedded.org/wiki/Main_Page">OpenEmbedded</a> project. It is not a Linux
distribution. But it contains the tools to create a Linux distribution
specially fitted to the product requirements. The most important step in
bringing order to the set of tools is to define a common versioning scheme and
a reference system. All subprojects have then to comply with the reference
system and have to comply with the versioning scheme.</p>
<p>The release process is similar to the <a class="reference external" href="https://kernel.org/">Linux kernel</a>.
Yocto increases its version number every six months and gives the release a
codename. The release list can be found here:
<a class="reference external" href="https://wiki.yoctoproject.org/wiki/Releases">https://wiki.yoctoproject.org/wiki/Releases</a></p>
</section>
<section id="core-components">
<h2><span class="section-number">2.2. </span>Core Components<a class="headerlink" href="#core-components" title="Link to this heading"></a></h2>
<p>The most important tools or subprojects of the <em>Yocto</em> Project are:</p>
<ul class="simple">
<li><p>Bitbake: build engine, a task scheduler like make, interprets metadata</p></li>
<li><p>OpenEmbedded-Core, a set of base layers, containing metadata of software, no
sources</p></li>
<li><p>Yocto kernel</p>
<ul>
<li><p>Optimized for embedded devices</p></li>
<li><p>Includes many subprojects: rt-kernel, vendor patches</p></li>
<li><p>The infrastructure provided by Wind River</p></li>
<li><p>Alternative: classic kernel build → we use it to integrate our kernel into
<em>Yocto</em></p></li>
</ul>
</li>
<li><p><em>Yocto</em> Reference BSP: <em>beagleboneblack</em>, <em>minnow max</em></p></li>
<li><p><em>Poky</em>, the reference system, a collection of projects and tools, used to
bootstrap a new distribution based on <em>Yocto</em></p></li>
</ul>
</section>
<section id="vocabulary">
<h2><span class="section-number">2.3. </span>Vocabulary<a class="headerlink" href="#vocabulary" title="Link to this heading"></a></h2>
<section id="recipes">
<h3><span class="section-number">2.3.1. </span>Recipes<a class="headerlink" href="#recipes" title="Link to this heading"></a></h3>
<p>Recipes contain information about the software project (author, homepage, and
license). A recipe is versioned, defines dependencies, contains the URL of the
source code, and describes how to fetch, configure, and compile the sources. It
describes how to package the software, e.g. into different .deb packages, which
then contain the installation path. Recipes are basically written in <em>Bitbake’s</em>
own programming language, which has a simple syntax. However, a recipe can
contain <em>Python</em> as well as a bash code.</p>
</section>
<section id="classes">
<h3><span class="section-number">2.3.2. </span>Classes<a class="headerlink" href="#classes" title="Link to this heading"></a></h3>
<p>Classes combine functionality used inside recipes into reusable blocks.</p>
</section>
<section id="layers">
<h3><span class="section-number">2.3.3. </span>Layers<a class="headerlink" href="#layers" title="Link to this heading"></a></h3>
<p>A layer is a collection of recipes, classes, and configuration metadata.
A layer can depend on other layers and can be included or excluded one
by one. It encapsulates a specific functionality and fulfills a specific
purpose. Each layer falls into a specific category:</p>
<ul class="simple">
<li><p>Base</p></li>
<li><p>Machine (BSP)</p></li>
<li><p>Software</p></li>
<li><p>Distribution</p></li>
<li><p>Miscellaneous</p></li>
</ul>
<p><em>Yocto’s</em> versioning scheme is reflected in every layer as version branches. For
each <em>Yocto</em> version, every layer has a named branch in its <em>Git</em> repository.
You can add one or many layers of each category in your build.</p>
<p>A collection of OpenEmbedded layers can be found here. The search function is
very helpful to see if a software package can be retrieved and integrated
easily: <a class="reference external" href="https://layers.openembedded.org/layerindex/branch/scarthgap/layers/">layerindex</a></p>
</section>
<section id="machine">
<h3><span class="section-number">2.3.4. </span>Machine<a class="headerlink" href="#machine" title="Link to this heading"></a></h3>
<p>Machines are configuration variables that describe the aspects of the target
hardware.</p>
</section>
<section id="distribution-distro">
<h3><span class="section-number">2.3.5. </span>Distribution (Distro)<a class="headerlink" href="#distribution-distro" title="Link to this heading"></a></h3>
<p>Distribution describes the software configuration and comes with a set of
software features.</p>
</section>
</section>
<section id="poky">
<h2><span class="section-number">2.4. </span>Poky<a class="headerlink" href="#poky" title="Link to this heading"></a></h2>
<p><em>Poky</em> is the reference system to define <em>Yocto</em> Project compatibility. It
combines several subprojects into releases:</p>
<ul class="simple">
<li><p><em>Bitbake</em></p></li>
<li><p><em>Toaster</em></p></li>
<li><p>OpenEmbedded Core</p></li>
<li><p><em>Yocto</em> Documentation</p></li>
<li><p><em>Yocto</em> Reference BSP</p></li>
</ul>
<section id="id1">
<h3><span class="section-number">2.4.1. </span>Bitbake<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p><em>Bitbake</em> is the task scheduler. It is written in <em>Python</em> and interprets
recipes that contain code in <em>Bitbake’s</em> own programming language, <em>Python</em>, and
bash code. The official documentation can be found here: <a class="reference external" href="https://docs.yoctoproject.org/bitbake/2.8/index.html">Bitbake</a></p>
</section>
<section id="id2">
<h3><span class="section-number">2.4.2. </span>Toaster<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p><em>Toaster</em> is a web frontend for <em>Bitbake</em> to start and investigate builds. It
provides information about the build history and statistics on created images.
There are several use cases where the installation and maintenance of
a <em>Toaster</em> instance are beneficial. PHYTEC did not add or remove any features
to the upstream <em>Toaster</em>, provided by <em>Poky</em>. The best source for more
information is the official documentation: <a class="reference external" href="https://docs.yoctoproject.org/dev/toaster-manual/index.html">Toaster</a></p>
</section>
</section>
<section id="official-documentation">
<h2><span class="section-number">2.5. </span>Official Documentation<a class="headerlink" href="#official-documentation" title="Link to this heading"></a></h2>
<p>For more general questions about <em>Bitbake</em> and <em>Poky</em> consult the mega-manual:
<a class="reference external" href="https://docs.yoctoproject.org/dev/singleindex.html">megamanual</a></p>
</section>
</section>
<section id="compatible-linux-distributions">
<h1><span class="section-number">3. </span>Compatible Linux Distributions<a class="headerlink" href="#compatible-linux-distributions" title="Link to this heading"></a></h1>
<p>To build <em>Yocto</em> you need a compatible <em>Linux</em> host development machine. The
list of supported distributions can be found in the reference manual:
<a class="reference external" href="https://docs.yoctoproject.org/dev/ref-manual/system-requirements.html#supported-linux-distributions">Supported Distributions</a></p>
</section>
<section id="phytec-bsp-introduction">
<h1><span class="section-number">4. </span>PHYTEC BSP Introduction<a class="headerlink" href="#phytec-bsp-introduction" title="Link to this heading"></a></h1>
<section id="bsp-structure">
<h2><span class="section-number">4.1. </span>BSP Structure<a class="headerlink" href="#bsp-structure" title="Link to this heading"></a></h2>
<p>The BSP consists roughly of three parts. BSP management, BSP metadata, and BSP
content. The management consists of <em>Repo</em> and phyLinux while the metadata
depends on the SOC, which describes how to build the software. The content
comprises PHYTEC’s <em>Git</em> repositories and external sources.</p>
<section id="bsp-management">
<h3><span class="section-number">4.1.1. </span>BSP Management<a class="headerlink" href="#bsp-management" title="Link to this heading"></a></h3>
<p><em>Yocto</em> is an umbrella project. Naturally, this will force the user to base
their work on several external repositories. They need to be managed in a
deterministic way. We use manifest files, which contain an XML data structure,
to describe all git repositories with pinned-down versions. The <em>Repo</em> tool and
our phyLinux wrapper script are used to manage the manifests and set up the BSP,
as described in the manifest file.</p>
<section id="phylinux">
<h4><span class="section-number">4.1.1.1. </span>phyLinux<a class="headerlink" href="#phylinux" title="Link to this heading"></a></h4>
<p>phyLinux is a wrapper for <em>Repo</em> to handle downloading and setting up the BSP
with an “out of the box” experience.</p>
</section>
<section id="repo">
<h4><span class="section-number">4.1.1.2. </span>Repo<a class="headerlink" href="#repo" title="Link to this heading"></a></h4>
<p><em>Repo</em> is a wrapper around the <em>Repo</em> toolset. The phyLinux script will install
the wrapper in a global path. This is only a wrapper, though. Whenever you run
<code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">init</span> <span class="pre">-u</span> <span class="pre">&lt;url&gt;</span></code>, you first download the <em>Repo</em> tools from <em>Googles</em> Git
server in a specific version to the <code class="docutils literal notranslate"><span class="pre">.repo/repo</span></code> directory. The next time you
run <em>Repo</em>, all the commands will be available. Be aware that the <em>Repo</em> version
in different build directories can differ over the years if you do not run <em>Repo
sync</em>. Also if you store information for your archives, you need to include the
complete <code class="docutils literal notranslate"><span class="pre">.repo</span></code> folder.</p>
<p><em>Repo</em> expects a <em>Git</em> repository which will be parsed from the command line. In
the PHYTEC BSP, it is called phy²octo. In this repository, all information about
a software BSP release is stored in the form of a <em>Repo</em> XML manifest. This data
structure defines URLs of <em>Git</em> servers (called “remotes”) and <em>Git</em>
repositories and their states (called “projects”). The <em>Git</em> repositories can be
seen in different states. The revision field can be a branch, tag, or commit id
of a repository. This means the state of the software is not necessarily unique
and can change over time. That is the reason we use only tags or commit ids for
our releases. The state of the working directory is then unique and does not
change.</p>
<p>The manifests for the releases have the same name as the release itself. It is a
unique identifier for the complete BSP. The releases are sorted by the SoC
platform. The selected SoC will define the branch of the phy²octo <em>Git</em>
repository which will be used for the manifest selection.</p>
</section>
</section>
<section id="bsp-metadata">
<h3><span class="section-number">4.1.2. </span>BSP Metadata<a class="headerlink" href="#bsp-metadata" title="Link to this heading"></a></h3>
<p>We include several third-party layers in our BSP to get a complete <em>Linux</em>
distribution up and running without the need to integrate external projects. All
used repositories are described in the following section.</p>
<section id="id3">
<h4><span class="section-number">4.1.2.1. </span>Poky<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p>The PHYTEC BSP is built on top of <em>Poky</em>. It comes with a specific version,
defined in the <em>Repo</em> manifest. <em>Poky</em> comes with a specific version of
<em>Bitbake</em>. The OpenEmbedded-core layer “meta” is used as a base for our <em>Linux</em>
system.</p>
</section>
<section id="meta-openembedded">
<h4><span class="section-number">4.1.2.2. </span>meta-openembedded<a class="headerlink" href="#meta-openembedded" title="Link to this heading"></a></h4>
<p>OpenEmbedded is a collection of different layers containing the meta description
for many open-source software projects. We ship all OpenEmbedded layers with our
BSP, but not all of them are activated. Our example images pull several software
packages generated from OpenEmbedded recipes.</p>
</section>
<section id="meta-qt6">
<h4><span class="section-number">4.1.2.3. </span>meta-qt6<a class="headerlink" href="#meta-qt6" title="Link to this heading"></a></h4>
<p>This layer provides an integration of <em>Qt6</em> in the <em>Poky</em>-based root filesystem
and is integrated into our BSP.</p>
</section>
<section id="meta-nodejs">
<h4><span class="section-number">4.1.2.4. </span>meta-nodejs<a class="headerlink" href="#meta-nodejs" title="Link to this heading"></a></h4>
<p>This is an application layer to add recent Node.js versions.</p>
</section>
<section id="meta-gstreamer1-0">
<h4><span class="section-number">4.1.2.5. </span>meta-gstreamer1.0<a class="headerlink" href="#meta-gstreamer1-0" title="Link to this heading"></a></h4>
<p>This is an application layer to add recent GStreamer versions.</p>
</section>
<section id="meta-rauc">
<h4><span class="section-number">4.1.2.6. </span>meta-rauc<a class="headerlink" href="#meta-rauc" title="Link to this heading"></a></h4>
<p>This layer contains the tools required to build an updated infrastructure with
<a class="reference external" href="https://rauc.readthedocs.io/en/latest/index.html">RAUC</a>. A comparison with
other update systems can be found here: <a class="reference external" href="https://wiki.yoctoproject.org/wiki/System_Update">Yocto update tools</a>.</p>
</section>
<section id="meta-phytec">
<h4><span class="section-number">4.1.2.7. </span>meta-phytec<a class="headerlink" href="#meta-phytec" title="Link to this heading"></a></h4>
<p>This layer contains all machines and common features for all our BSPs. It is
PHYTEC’s <a class="reference external" href="https://docs.yoctoproject.org/dev/bsp-guide/index.html">Yocto Board Support Package</a> for all supported hardware (since
<em>fido</em>) and is designed to be standalone with <em>Poky</em>. Only these two parts are
required if you want to integrate the PHYTEC’s hardware into your existing
<em>Yocto</em> workflow. The features are:</p>
<ul class="simple">
<li><p>Bootloaders in <code class="docutils literal notranslate"><span class="pre">recipes-bsp/barebox/</span></code> and <code class="docutils literal notranslate"><span class="pre">recipes-bsp/u-boot/</span></code></p></li>
<li><p>Kernels in <code class="docutils literal notranslate"><span class="pre">recipes-kernel/linux/</span></code> and
<code class="docutils literal notranslate"><span class="pre">dynamic-layers/fsl-bsp-release/recipes-kernel/linux/</span></code></p></li>
<li><p>Many machines in <code class="docutils literal notranslate"><span class="pre">conf/machine/</span></code></p></li>
<li><p>Proprietary <em>OpenGL ES/EGL</em> user space libraries for AM335x and i.MX 6
platforms</p></li>
<li><p>Proprietary <em>OpenCL</em> libraries for i.MX 6 platforms</p></li>
</ul>
</section>
<section id="meta-ampliphy">
<h4><span class="section-number">4.1.2.8. </span>meta-ampliphy<a class="headerlink" href="#meta-ampliphy" title="Link to this heading"></a></h4>
<p>This is our example distribution and BSP layer. It extends the basic
configuration of <em>Poky</em> with software projects described by all the other BSP
components. It provides a base for your specific development scenarios. The
current features are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> init system</p></li>
<li><p>Images: <code class="docutils literal notranslate"><span class="pre">phytec-headless-image</span></code> for non-graphics applications</p></li>
<li><p>Camera integration with OpenCV and GStreamer examples for the i.MX 6 platform
bundled in a <code class="docutils literal notranslate"><span class="pre">phytec-vision-image</span></code></p></li>
<li><p>RAUC integration: we set up basic support for an A/B system image update,
which is possible locally and over-the-air</p></li>
</ul>
</section>
<section id="meta-qt6-phytec">
<h4><span class="section-number">4.1.2.9. </span>meta-qt6-phytec<a class="headerlink" href="#meta-qt6-phytec" title="Link to this heading"></a></h4>
<p>This is our layer for Qt6 board integration and examples. The features are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doc.qt.io/qt-5/embedded-linux.html">Qt6 with eglfs backend</a> for
PHYTEC’s AM335x, i.MX 6 and RK3288 platforms</p></li>
<li><p>Images: <code class="docutils literal notranslate"><span class="pre">phytec-qt6demo-image</span></code> for <em>Qt6</em> and video applications</p></li>
<li><p>A <em>Qt6</em> demo application demonstrating how to create a <em>Qt6</em> project using
<em>QML</em> widgets and a <em>Bitbake</em> recipe for the <em>Yocto</em> and <em>systemd</em>
integration. It can be found in
<code class="docutils literal notranslate"><span class="pre">sources/meta-qt6-phytec/recipes-qt/examples/phytec-qtdemo_git.bb</span></code></p></li>
</ul>
</section>
<section id="meta-virtualization">
<h4><span class="section-number">4.1.2.10. </span>meta-virtualization<a class="headerlink" href="#meta-virtualization" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer provides support for building Xen, KVM, Libvirt, and associated
packages necessary for constructing OE-based virtualized solutions.</p></li>
</ul>
</section>
<section id="id4">
<h4><span class="section-number">4.1.2.11. </span>meta-security<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer provides security tools, hardening tools for Linux kernels, and
libraries for implementing security mechanisms.</p></li>
</ul>
</section>
<section id="meta-selinux">
<h4><span class="section-number">4.1.2.12. </span>meta-selinux<a class="headerlink" href="#meta-selinux" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer’s purpose is to enable SE Linux support. The majority of this
layer’s work is accomplished in <em>bbappend</em> files, used to enable SE Linux
support in existing recipes.</p></li>
</ul>
</section>
<section id="meta-browser">
<h4><span class="section-number">4.1.2.13. </span>meta-browser<a class="headerlink" href="#meta-browser" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This is an application layer to add recent web browsers (Chromium, Firefox,
etc.).</p></li>
</ul>
</section>
<section id="meta-rust">
<h4><span class="section-number">4.1.2.14. </span>meta-rust<a class="headerlink" href="#meta-rust" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Includes the Rust compiler and the Cargo package manager for Rust.</p></li>
</ul>
</section>
<section id="meta-timesys">
<h4><span class="section-number">4.1.2.15. </span>meta-timesys<a class="headerlink" href="#meta-timesys" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Timesys layer for Vigiles Yocto CVE monitoring, security notifications, and
image manifest generation.</p></li>
</ul>
</section>
<section id="meta-freescale">
<h4><span class="section-number">4.1.2.16. </span>meta-freescale<a class="headerlink" href="#meta-freescale" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer provides support for the i.MX, Layerscape, and QorIQ product
lines.</p></li>
</ul>
</section>
<section id="meta-freescale-3rdparty">
<h4><span class="section-number">4.1.2.17. </span>meta-freescale-3rdparty<a class="headerlink" href="#meta-freescale-3rdparty" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Provides support for boards from various vendors.</p></li>
</ul>
</section>
<section id="meta-freescale-distro">
<h4><span class="section-number">4.1.2.18. </span>meta-freescale-distro<a class="headerlink" href="#meta-freescale-distro" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer provides support for Freescale’s Demonstration images for use with
OpenEmbedded and/or Yocto Freescale’s BSP layer.</p></li>
</ul>
</section>
<section id="base-fsl-community-bsp-base">
<h4><span class="section-number">4.1.2.19. </span>base (fsl-community-bsp-base)<a class="headerlink" href="#base-fsl-community-bsp-base" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This layer provides BSP base files of NXP.</p></li>
</ul>
</section>
<section id="meta-fsl-bsp-release">
<h4><span class="section-number">4.1.2.20. </span>meta-fsl-bsp-release<a class="headerlink" href="#meta-fsl-bsp-release" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>This is the i.MX Yocto Project Release Layer.</p></li>
</ul>
</section>
</section>
<section id="bsp-content">
<h3><span class="section-number">4.1.3. </span>BSP Content<a class="headerlink" href="#bsp-content" title="Link to this heading"></a></h3>
<p>The BSP content gets pulled from different online sources when you first start
using <em>Bitbake</em>. All files will be downloaded and cloned in a local directory
configured as <code class="docutils literal notranslate"><span class="pre">DL_DIR</span></code> in <em>Yocto</em>. If you backup your BSP with the complete
content, those sources have to be backed up, too. How you can do this will be
explained in the chapter <a class="reference internal" href="#scarthgap-gen-source-mirrors"><span class="std std-ref">Generating Source Mirrors, working Offline</span></a>.</p>
</section>
</section>
<section id="build-configuration">
<h2><span class="section-number">4.2. </span>Build Configuration<a class="headerlink" href="#build-configuration" title="Link to this heading"></a></h2>
<p>The BSP initializes a build folder that will contain all files you
create by running <em>Bitbake</em> commands. It contains a <code class="docutils literal notranslate"><span class="pre">conf</span></code> folder
that handles build input variables.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bblayers.conf</span></code> defines activated meta-layers,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local.conf</span></code> defines build input variables specific to your build</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site.conf</span></code> defines build input variables specific to the development host</p></li>
</ul>
<p>The two topmost build input variables are <code class="docutils literal notranslate"><span class="pre">DISTRO</span></code> and <code class="docutils literal notranslate"><span class="pre">MACHINE</span></code>. They are
preconfigured <code class="docutils literal notranslate"><span class="pre">local.conf</span></code> when you check out the BSP using phyLinux.</p>
<p>We use “<em>Ampliphy</em>” as <code class="docutils literal notranslate"><span class="pre">DISTRO</span></code> with our BSP. This distribution will be
preselected and give you a starting point for implementing your own
configuration.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">MACHINE</span></code> defines a binary image that supports specific hardware
combinations of module and baseboard. Check the <code class="docutils literal notranslate"><span class="pre">machine.conf</span></code> file or our
webpage for a description of the hardware.</p>
</section>
</section>
<section id="pre-built-images">
<h1><span class="section-number">5. </span>Pre-built Images<a class="headerlink" href="#pre-built-images" title="Link to this heading"></a></h1>
<p>For each BSP we provide pre-built target images that can be downloaded from the
PHYTEC FTP server: <a class="reference external" href="https://download.phytec.de/Software/Linux/">https://download.phytec.de/Software/Linux/</a></p>
<p>These images are also used for the BSP tests, which are flashed to the boards
during production. You can use the provided <code class="docutils literal notranslate"><span class="pre">.wic</span></code> images to create a bootable
SD card at any time. Identify your hardware and flash the downloaded image file
to an empty SD card using <code class="docutils literal notranslate"><span class="pre">dd</span></code>. Please see section Images for information
about the correct usage of the command.</p>
</section>
<section id="bsp-workspace-installation">
<h1><span class="section-number">6. </span>BSP Workspace Installation<a class="headerlink" href="#bsp-workspace-installation" title="Link to this heading"></a></h1>
<section id="setting-up-the-host">
<h2><span class="section-number">6.1. </span>Setting Up the Host<a class="headerlink" href="#setting-up-the-host" title="Link to this heading"></a></h2>
<p>You can set up the host or use one of our build-container to run a Yocto build.
You need to have a running <em>Linux</em> distribution. It should be running on a
powerful machine since a lot of compiling will need to be done.</p>
<p>If you want to use a build-container, you only need to install following
packages on your host</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>wget<span class="w"> </span>git
</pre></div>
</div>
<p>Continue with the next step <a class="reference internal" href="#scarthgap-git-config"><span class="std std-ref">Git Configuration</span></a> after that. The
documentation for using build-container can be found in this manual after
<a class="reference internal" href="#scarthgap-phylinux-advanced-usage"><span class="std std-ref">Advanced Usage</span></a> of phyLinux.</p>
<p>Else <em>Yocto</em> needs a handful of additional packages on your host. For <em>Ubuntu</em>
you need</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gawk<span class="w"> </span>wget<span class="w"> </span>git<span class="w"> </span>diffstat<span class="w"> </span>unzip<span class="w"> </span>texinfo<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>gcc<span class="w"> </span>build-essential<span class="w"> </span>chrpath<span class="w"> </span>socat<span class="w"> </span>cpio<span class="w"> </span>python3<span class="w"> </span>python3-pip<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>python3-pexpect<span class="w"> </span>xz-utils<span class="w"> </span>debianutils<span class="w"> </span>iputils-ping<span class="w"> </span>python3-git<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>python3-jinja2<span class="w"> </span>libegl1-mesa<span class="w"> </span>libsdl1.2-dev<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>python3-subunit<span class="w"> </span>mesa-common-dev<span class="w"> </span>zstd<span class="w"> </span>liblz4-tool<span class="w"> </span>file<span class="w"> </span>locales
</pre></div>
</div>
<p>For other distributions you can find information in the <em>Yocto</em> Quick Build:
<a class="reference external" href="https://docs.yoctoproject.org/dev/brief-yoctoprojectqs/index.html">Quick Build</a></p>
</section>
<section id="git-configuration">
<span id="scarthgap-git-config"></span><h2><span class="section-number">6.2. </span>Git Configuration<a class="headerlink" href="#git-configuration" title="Link to this heading"></a></h2>
<p>The BSP heavily utilizes <em>Git</em>. <em>Git</em> needs some information from
you as a user to identify who made changes. Create a <code class="docutils literal notranslate"><span class="pre">~/.gitconfig</span></code> with the
following content, if you do not have one</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>[user]
<span class="w">    </span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;Your<span class="w"> </span>Name&gt;
<span class="w">    </span>email<span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;Your<span class="w"> </span>Mail&gt;
[core]
<span class="w">    </span>editor<span class="w"> </span><span class="o">=</span><span class="w"> </span>vim
[merge]
<span class="w">    </span>tool<span class="w"> </span><span class="o">=</span><span class="w"> </span>vimdiff
[alias]
<span class="w">    </span>co<span class="w"> </span><span class="o">=</span><span class="w"> </span>checkout
<span class="w">    </span>br<span class="w"> </span><span class="o">=</span><span class="w"> </span>branch
<span class="w">    </span>ci<span class="w"> </span><span class="o">=</span><span class="w"> </span>commit
<span class="w">    </span>st<span class="w"> </span><span class="o">=</span><span class="w"> </span>status
<span class="w">    </span>unstage<span class="w"> </span><span class="o">=</span><span class="w"> </span>reset<span class="w"> </span>HEAD<span class="w"> </span>--
<span class="w">    </span>last<span class="w"> </span><span class="o">=</span><span class="w"> </span>log<span class="w"> </span>-1<span class="w"> </span>HEAD
[push]
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>current
[color]
<span class="w">    </span>ui<span class="w"> </span><span class="o">=</span><span class="w"> </span>auto
</pre></div>
</div>
<p>You should set <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">email</span></code> in your <em>Git</em> configuration, otherwise,
<em>Bitbake</em> will complain during the first build. You can use the two commands to
set them directly without editing <code class="docutils literal notranslate"><span class="pre">~/.gitconfig</span></code> manually</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span><span class="s2">&quot;your_email@example.com&quot;</span>
<span class="gp">host:~$ </span>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;name surname&quot;</span>
</pre></div>
</div>
</section>
<section id="site-conf-setup">
<h2><span class="section-number">6.3. </span>site.conf Setup<a class="headerlink" href="#site-conf-setup" title="Link to this heading"></a></h2>
<p>Before starting the <em>Yocto</em> build, it is advisable to configure the development
setup. Two things are most important: the download directory and the cache
directory. PHYTEC strongly recommends configuring the setup as it will reduce
the compile time of consequent builds.</p>
<p>A download directory is a place where <em>Yocto</em> stores all sources fetched from
the internet. It can contain tar.gz, <em>Git</em> mirror, etc. It is very useful to set
this to a common shared location on the machine. Create this directory with 777
access rights. To share this directory with different users, all files need to
have group write access. This will most probably be in conflict with default
<em>umask</em> settings. One possible solution would be to use ACLs for this
directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>acl
<span class="gp">host:~$ </span>sudo<span class="w"> </span>setfacl<span class="w"> </span>-R<span class="w"> </span>-d<span class="w"> </span>-m<span class="w"> </span>g::rwx<span class="w"> </span>&lt;dl_dir&gt;
</pre></div>
</div>
<p>If you have already created a download directory and want to fix the permissions
afterward, you can do so with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>find<span class="w"> </span>/home/share/<span class="w"> </span>-perm<span class="w"> </span>/u<span class="o">=</span>r<span class="w"> </span>!<span class="w"> </span>-perm<span class="w"> </span>/g<span class="o">=</span>r<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span>g+r<span class="w"> </span><span class="se">\{\}</span><span class="w"> </span><span class="se">\;</span>
<span class="gp">host:~$ </span>sudo<span class="w"> </span>find<span class="w"> </span>/home/share/<span class="w"> </span>-perm<span class="w"> </span>/u<span class="o">=</span>w<span class="w"> </span>!<span class="w"> </span>-perm<span class="w"> </span>/g<span class="o">=</span>w<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span>g+w<span class="w"> </span><span class="se">\{\}</span><span class="w"> </span><span class="se">\;</span>
<span class="gp">host:~$ </span>sudo<span class="w"> </span>find<span class="w"> </span>/home/share/<span class="w"> </span>-perm<span class="w"> </span>/u<span class="o">=</span>x<span class="w"> </span>!<span class="w"> </span>-perm<span class="w"> </span>/g<span class="o">=</span>x<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span>g+x<span class="w"> </span><span class="se">\{\}</span><span class="w"> </span><span class="se">\;</span>
</pre></div>
</div>
<p>The cache directory stores all stages of the build process. <em>Poky</em> has quite an
involved caching infrastructure. It is advisable to create a shared directory,
as all builds can access this cache directory, called the shared state cache.</p>
<p>Create the two directories on a drive where you have approximately 50 GB of
space and assign the two variables in your <code class="docutils literal notranslate"><span class="pre">build/conf/local.conf</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DL_DIR ?= &quot;&lt;your_directory&gt;/yocto_downloads&quot;
SSTATE_DIR ?= &quot;&lt;your_directory&gt;/yocto_sstate&quot;
</pre></div>
</div>
<p>If you want to know more about configuring your build, see the documented
example settings</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sources/poky/meta-yocto/conf/local.conf.sample
sources/poky/meta-yocto/conf/local.conf.sample.extended
</pre></div>
</div>
</section>
</section>
<section id="phylinux-documentation">
<h1><span class="section-number">7. </span>phyLinux Documentation<a class="headerlink" href="#phylinux-documentation" title="Link to this heading"></a></h1>
<p>The phyLinux script is a basic management tool for PHYTEC <em>Yocto</em> BSP releases
written in <em>Python</em>. It is mainly a helper to get started with the BSP
structure. You can get all the BSP sources without the need of interacting with
<em>Repo</em> or <em>Git</em>.</p>
<p>The phyLinux script has only one real dependency. It requires the <em>wget</em> tool
installed on your host. It will also install the <a class="reference external" href="https://source.android.com/docs/setup/download">Repo tool</a> in a global path
(/usr/local/bin) on your host PC. You can install it in a different location
manually. <em>Repo</em> will be automatically detected by phyLinux if it is found in
the PATH. The <em>Repo</em> tool will be used to manage the different <em>Git</em>
repositories of the <em>Yocto</em> BSP.</p>
<section id="get-phylinux">
<h2><span class="section-number">7.1. </span>Get phyLinux<a class="headerlink" href="#get-phylinux" title="Link to this heading"></a></h2>
<p>The phyLinux script can be found on the PHYTEC download server:
<a class="reference external" href="https://download.phytec.de/Software/Linux/Yocto/Tools/phyLinux">https://download.phytec.de/Software/Linux/Yocto/Tools/phyLinux</a></p>
</section>
<section id="basic-usage">
<h2><span class="section-number">7.2. </span>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h2>
<p>For the basic usage of phyLinux, type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>--help
</pre></div>
</div>
<p>which will result in</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage: phyLinux [-h] [-v] [--verbose] {init,info,clean} ...

This Programs sets up an environment to work with The Yocto Project on Phytecs
Development Kits. Use phyLinx &lt;command&gt; -h to display the help text for the
available commands.

positional arguments:
  {init,info,clean}  commands
    init             init the phytec bsp in the current directory
    info             print info about the phytec bsp in the current directory
    clean            Clean up the current working directory

optional arguments:
  -h, --help         show this help message and exit
  -v, --version      show program&#39;s version number and exit
  --verbose
</pre></div>
</div>
</section>
<section id="initialization">
<h2><span class="section-number">7.3. </span>Initialization<a class="headerlink" href="#initialization" title="Link to this heading"></a></h2>
<p>Create a fresh project folder</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mkdir<span class="w"> </span>~/yocto
</pre></div>
</div>
<p>Calling phyLinux will use the default Python version. Starting with Ubuntu 20.04
it will be Python3. If you want to initiate a BSP, which is not compatible with
Python3, you need to set Python2 as default (temporarily) before running
phyLinux</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>ln<span class="w"> </span>-s<span class="w"> </span><span class="se">\`</span>which<span class="w"> </span>python2<span class="se">\`</span><span class="w"> </span>python<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>Now run phyLinux from the new folder</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>init
</pre></div>
</div>
<p>A clean folder is important because phyLinux will clean its working directory.
Calling phyLinux from a directory that isn’t empty will result in the following
<strong>warning</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This current directory is not empty. It could lead to errors in the BSP
configuration process if you continue from here. At the very least, you
have to check your build directory for settings in bblayers.conf and
local.conf, which will not be handled correctly in all cases. It is
advisable to start from an empty directory of call:
$ ./phyLinux clean
Do you really want to continue from here?
[yes/no]:
</pre></div>
</div>
<p>On the first initialization, the phyLinux script will ask you to install the
<em>Repo</em> tool in your <em>/usr/local/bin</em> directory. During the execution of the
<em>init</em> command, you need to choose your processor platform (SoC), PHYTEC’s BSP
release number, and the hardware you are working on</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>***************************************************
* Please choose one of the available SoC Platforms:
*
*   1: am335x
*   2: am57x
*   3: am62ax
*   4: am62x
*   5: am64x
*   6: am68x
*   7: imx6
*   8: imx6ul
*   9: imx7
*   10: imx8
*   11: imx8m
*   12: imx8mm
*   13: imx8mp
*   14: imx8x
*   15: imx93
*   16: nightly
*   17: rk3288
*   18: stm32mp13x
*   19: stm32mp15x
*   20: topic

# Exemplary output for chosen imx8mp
***************************************************
* Please choose one of the available Releases:
*
*   1: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1-rc1
*   2: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1-rc2
*   3: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.0
*   4: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.1
*   5: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.2-rc1
*   6: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.2
*   7: BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.y
*   8: BSP-Yocto-Ampliphy-i.MX8MP-master
*   9: BSP-Yocto-FSL-i.MX8MP-ALPHA1
*   10: BSP-Yocto-FSL-i.MX8MP-ALPHA2
*   11: BSP-Yocto-FSL-i.MX8MP-PD21.1-rc1
*   12: BSP-Yocto-FSL-i.MX8MP-PD21.1-rc2
*   13: BSP-Yocto-FSL-i.MX8MP-PD21.1.0
*   14: BSP-Yocto-FSL-i.MX8MP-PD21.1.1-rc1
*   15: BSP-Yocto-FSL-i.MX8MP-PD21.1.1-rc2
*   16: BSP-Yocto-FSL-i.MX8MP-PD21.1.1
*   17: BSP-Yocto-FSL-i.MX8MP-PD21.1.2-rc1
*   18: BSP-Yocto-FSL-i.MX8MP-PD21.1.2-rc2
*   19: BSP-Yocto-FSL-i.MX8MP-PD21.1.2
*   20: BSP-Yocto-FSL-i.MX8MP-PD21.1.3-rc1
*   21: BSP-Yocto-FSL-i.MX8MP-PD21.1.3
*   22: BSP-Yocto-NXP-i.MX8MP-PD22.1-rc1
*   23: BSP-Yocto-NXP-i.MX8MP-PD22.1-rc2
*   24: BSP-Yocto-NXP-i.MX8MP-PD22.1-rc3
*   25: BSP-Yocto-NXP-i.MX8MP-PD22.1-rc4
*   26: BSP-Yocto-NXP-i.MX8MP-PD22.1.0
*   27: BSP-Yocto-NXP-i.MX8MP-PD22.1.1-rc1
*   28: BSP-Yocto-NXP-i.MX8MP-PD22.1.1-rc2
*   29: BSP-Yocto-NXP-i.MX8MP-PD22.1.1-rc3
*   30: BSP-Yocto-NXP-i.MX8MP-PD22.1.1-rc4
*   31: BSP-Yocto-NXP-i.MX8MP-PD22.1.1
*   32: BSP-Yocto-NXP-i.MX8MP-PD22.1.2-rc1
*   33: BSP-Yocto-NXP-i.MX8MP-PD22.1.2-rc2
*   34: BSP-Yocto-NXP-i.MX8MP-PD22.1.2
*   35: BSP-Yocto-NXP-i.MX8MP-PD22.1.y
*   36: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc1
*   37: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc2
*   38: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc3
*   39: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc4
*   40: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc5
*   41: BSP-Yocto-NXP-i.MX8MP-PD23.1-rc6
*   42: BSP-Yocto-NXP-i.MX8MP-PD23.1.0
*   43: BSP-Yocto-NXP-i.MX8MP-PD23.1.y
*   44: BSP-Yocto-NXP-i.MX8MP-PD24.1-rc1
*   45: BSP-Yocto-NXP-i.MX8MP-PD24.1-rc2
*   46: BSP-Yocto-NXP-i.MX8MP-PD24.1-rc3
*   47: BSP-Yocto-NXP-i.MX8MP-PD24.1.0
*   48: BSP-Yocto-NXP-i.MX8MP-PD24.1.y

# Exemplary output for chosen BSP-Yocto-NXP-i.MX8MP-PD24.1.0
*********************************************************************
* Please choose one of the available builds:
*
no:                 machine: description and article number
                             distro: supported yocto distribution
                             target: supported build target

1: phyboard-pollux-imx8mp-3: PHYTEC phyBOARD-Pollux i.MX8M Plus 1-4GB RAM
                             Pollux PL1552.2
                             PB-03123-001.A3
                             distro: ampliphy-vendor
                             target: phytec-headless-image
2: phyboard-pollux-imx8mp-3: PHYTEC phyBOARD-Pollux i.MX8M Plus 1-4GB RAM
                             Pollux PL1552.2
                             PB-03123-001.A3
                             distro: ampliphy-vendor-rauc
                             target: phytec-headless-bundle
                             target: phytec-headless-image
3: phyboard-pollux-imx8mp-3: PHYTEC phyBOARD-Pollux i.MX8M Plus 1-4GB RAM
                             Pollux PL1552.2
                             PB-03123-001.A3
                             distro: ampliphy-vendor-xwayland
                             target: -c populate_sdk phytec-qt6demo-image
                             target: phytec-qt6demo-image
                             target: phytec-vision-image
4: phyboard-pollux-imx8mp-3: PHYTEC phyBOARD-Pollux i.MX8M Plus 1-4GB RAM
                             Pollux PL1552.2
                             PB-03123-001.A3
                             distro: securiphy-vendor
                             target: phytec-securiphy-bundle
                             target: phytec-securiphy-image
5: phyboard-pollux-imx8mp-3: PHYTEC phyBOARD-Pollux i.MX8M Plus 1-4GB RAM
                             Pollux PL1552.2
                             PB-03123-001.A3
                             distro: securiphy-vendor-provisioning
                             target: phytec-provisioning-image
</pre></div>
</div>
<p>If you cannot identify your board with the information given in the selector,
have a look at the invoice for the product. After the configuration is done,
you can always run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>info

<span class="gp"># </span>Exemplary<span class="w"> </span>output
<span class="go">**********************************************</span>
<span class="go">* The current BSP configuration is:</span>
<span class="go">*</span>
<span class="go">* SoC:  refs/heads/imx8mp</span>
<span class="go">* Release:  BSP-Yocto-NXP-i.MX8MP-PD24.1.0</span>
<span class="go">*</span>
<span class="go">**********************************************</span>
</pre></div>
</div>
<p>to see which SoC and Release are selected in the current workspace. If
you do not want to use the selector, phyLinux also supports command-line
arguments for several settings</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nv">MACHINE</span><span class="o">=</span>phyboard-pollux-imx8mp-3<span class="w"> </span>./phyLinux<span class="w"> </span>init<span class="w"> </span>-p<span class="w"> </span>imx8mp<span class="w"> </span>-r<span class="w"> </span>BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.0
</pre></div>
</div>
<p>or view the help command for more information</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w">  </span>init<span class="w"> </span>--help

<span class="go">usage: phyLinux init [-h] [--verbose] [--no-init] [-o REPOREPO] [-b REPOREPO_BRANCH] [-x XML] [-u URL] [-p PLATFORM] [-r RELEASE]</span>

<span class="go">options:</span>
<span class="go">  -h, --help          show this help message and exit</span>
<span class="go">  --verbose</span>
<span class="go">  --no-init           dont execute init after fetch</span>
<span class="go">  -o REPOREPO         Use repo tool from another url</span>
<span class="go">  -b REPOREPO_BRANCH  Checkout different branch of repo tool</span>
<span class="go">  -x XML              Use a local XML manifest</span>
<span class="go">  -u URL              Manifest git url</span>
<span class="go">  -p PLATFORM         Processor platform</span>
<span class="go">  -r RELEASE          Release version</span>
</pre></div>
</div>
<p>After the execution of the <em>init</em> command, phyLinux will print a few important
notes as well as information for the next steps in the build process.</p>
</section>
<section id="advanced-usage">
<span id="scarthgap-phylinux-advanced-usage"></span><h2><span class="section-number">7.4. </span>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading"></a></h2>
<p>phyLinux can be used to transport software states over any medium. The state of
the software is uniquely identified by <em>manifest.xml</em>. You can create a
manifest, send it to another place and recover the software state with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>init<span class="w"> </span>-x<span class="w"> </span>manifest.xml
</pre></div>
</div>
<p>You can also create a <em>Git</em> repository containing your software states. The
<em>Git</em> repository needs to have branches other than master, as we reserved the
master branch for different usage. Use phyLinux to check out the states</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>-u<span class="w"> </span>&lt;url-of-your-git-repo&gt;
</pre></div>
</div>
</section>
</section>
<section id="using-build-container">
<h1><span class="section-number">8. </span>Using build-container<a class="headerlink" href="#using-build-container" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, it is not possible to run the phyLinux script inside of a container.
After a complete init with the phyLinux script on your host machine, you can use a container for the build.
If you do not have phyLinux script running on your machine, please see phyLinux Documentation.</p>
</div>
<p>There are various possibilities to run a build-container. Commonly used is
docker and podman, though we prefer podman as it does not need root privileges
to run.</p>
<section id="installation">
<h2><span class="section-number">8.1. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>How to install podman: <a class="reference external" href="https://podman.io">https://podman.io</a>
How to install docker: <a class="reference external" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a></p>
</section>
<section id="available-container">
<h2><span class="section-number">8.2. </span>Available container<a class="headerlink" href="#available-container" title="Link to this heading"></a></h2>
<p>Right now we provide 4 different container based on Ubuntu LTS versions:
<a class="reference external" href="https://hub.docker.com/u/phybuilder">https://hub.docker.com/u/phybuilder</a></p>
<ul class="simple">
<li><p>yocto-ubuntu-16.04</p></li>
<li><p>yocto-ubuntu-18.04</p></li>
<li><p>yocto-ubuntu-20.04</p></li>
<li><p>yocto-ubuntu-22.04</p></li>
</ul>
<p>These containers can be run with podman or docker. With Yocto Project branch
Scarthgap the container “yocto-ubuntu-20.04” is preferred.</p>
</section>
<section id="download-pull-container">
<h2><span class="section-number">8.3. </span>Download/Pull container<a class="headerlink" href="#download-pull-container" title="Link to this heading"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>podman<span class="w"> </span>pull<span class="w"> </span>docker.io/phybuilder/yocto-ubuntu-20.04

<span class="go">OR</span>

<span class="gp">host:~$ </span>docker<span class="w"> </span>pull<span class="w"> </span>docker.io/phybuilder/yocto-ubuntu-20.04
</pre></div>
</div>
<p>By adding a tag at the end separated by a colon, you can also pull or run a
special tagged container.</p>
<blockquote>
<div><p>podman pull docker.io/phybuilder/yocto-ubuntu-20.04:phy2</p>
</div></blockquote>
<p>You can find all available tags in our duckerhub space:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://hub.docker.com/r/phybuilder/yocto-ubuntu-16.04/tags">https://hub.docker.com/r/phybuilder/yocto-ubuntu-16.04/tags</a></p></li>
<li><p><a class="reference external" href="https://hub.docker.com/r/phybuilder/yocto-ubuntu-18.04/tags">https://hub.docker.com/r/phybuilder/yocto-ubuntu-18.04/tags</a></p></li>
<li><p><a class="reference external" href="https://hub.docker.com/r/phybuilder/yocto-ubuntu-20.04/tags">https://hub.docker.com/r/phybuilder/yocto-ubuntu-20.04/tags</a></p></li>
<li><p><a class="reference external" href="https://hub.docker.com/r/phybuilder/yocto-ubuntu-22.04/tags">https://hub.docker.com/r/phybuilder/yocto-ubuntu-22.04/tags</a></p></li>
</ul>
<p>If you try to run a container, which is not pulled/downloaded, it will be
pulled/downloaded automatically.</p>
<p>You can have a look at all downloaded/pulled container with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>USERNAME@<span class="nv">$HOSTNAME</span>:~$<span class="w"> </span>podman<span class="w"> </span>images
<span class="go">REPOSITORY                               TAG         IMAGE ID      CREATED       SIZE</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-22.04  latest      d626178e448d  4 months ago  935 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-22.04  phy2        d626178e448d  4 months ago  935 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-20.04  phy2        e29a88b7172a  4 months ago  900 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-20.04  latest      e29a88b7172a  4 months ago  900 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-18.04  phy1        14c9c3e477d4  7 months ago  567 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-18.04  latest      14c9c3e477d4  7 months ago  567 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-16.04  phy1        28c73e13ab4f  7 months ago  599 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-16.04  latest      28c73e13ab4f  7 months ago  599 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-22.04  phy1        5a0ef4b41935  8 months ago  627 MB</span>
<span class="go">docker.io/phybuilder/yocto-ubuntu-20.04  phy1        b5a26a86c39f  8 months ago  680 MB</span>
</pre></div>
</div>
</section>
<section id="run-container">
<h2><span class="section-number">8.4. </span>Run container<a class="headerlink" href="#run-container" title="Link to this heading"></a></h2>
<p>To run and use container for a Yocto build, first enter to your folder, where
you run phyLinux init before. Then start the container</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>podman<span class="w"> </span>run<span class="w"> </span>--rm<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-v<span class="w"> </span>/home:/home<span class="w"> </span>--userns<span class="o">=</span>keep-id<span class="w"> </span>--workdir<span class="o">=</span><span class="nv">$PWD</span><span class="w"> </span>-it<span class="w"> </span>docker.io/phybuilder/yocto-ubuntu-20.04<span class="w"> </span>bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run and use a container with docker, it is not that simple like with podman.
Therefore the container-user has to be defined and configured.
Furthermore forwarding of credentials is not given per default and has to be configured as well.</p>
</div>
<p>Now your commandline should look something like that (where $USERNAME is the
user, who called “podman run” and the char/number code diffs every time a
container is started)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>USERNAME@6593e2c7b8f6:~$
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the given username is “root” you will not be able to run bitbake at all.
Please be sure, you run the container with your own user.</p>
</div>
<p>Now you are ready to go on and starting the build.
To stop/close the container, just call</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>USERNAME@6593e2c7b8f6:~$<span class="w"> </span><span class="nb">exit</span>
</pre></div>
</div>
</section>
</section>
<section id="working-with-poky-and-bitbake">
<h1><span class="section-number">9. </span>Working with Poky and Bitbake<a class="headerlink" href="#working-with-poky-and-bitbake" title="Link to this heading"></a></h1>
<section id="start-the-build">
<h2><span class="section-number">9.1. </span>Start the Build<a class="headerlink" href="#start-the-build" title="Link to this heading"></a></h2>
<p>After you download all the metadata with phyLinux init, you have to set up the
shell environment variables. This needs to be done every time you open a new
shell for starting builds. We use the shell script provided by <em>Poky</em> in its
default configuration. From the root of your project directory type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>sources/poky/oe-init-build-env
</pre></div>
</div>
<p>The abbreviation for the source command is a single dot</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>.<span class="w"> </span>sources/poky/oe-init-build-env
</pre></div>
</div>
<p>The current working directory of the shell should change to <em>build/</em>. Before
building for the first time, you should take a look at the main configuration
file</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>vim<span class="w"> </span>conf/local.conf
</pre></div>
</div>
<p>Your local modifications for the current build are stored here. Depending on
the SoC, you might need to accept license agreements. For example, to build the
image for Freescale/NXP processors you need to accept the GPU and VPU binary
license agreements. You have to uncomment the corresponding line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to accept NXP EULA # EULA can be found under</span>
../sources/meta-freescale/EULA<span class="w"> </span>ACCEPT_FSL_EULA<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>Now you are ready to build your first image. We suggest starting with our
smaller non-graphical image <em>phytec-headless-image</em> to see if everything is
working correctly</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image
</pre></div>
</div>
<p>The first compile process takes about 40 minutes on a modern Intel Core i7. All
subsequent builds will use the filled caches and should take about 3 minutes.</p>
</section>
<section id="images">
<h2><span class="section-number">9.2. </span>Images<a class="headerlink" href="#images" title="Link to this heading"></a></h2>
<p>If everything worked, the images can be found under</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>deploy/images/&lt;MACHINE&gt;
</pre></div>
</div>
<p>The easiest way to test your image is to configure your board for SD card boot
and to flash the build image to the SD card</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>phytec-headless-image-&lt;MACHINE&gt;.wic<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/&lt;your_device&gt;<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>fsync
</pre></div>
</div>
<p>Here &lt;your_device&gt; could be “sde”, for example, depending on your system. Be
very careful when selecting the right drive! Selecting the wrong drive can
erase your hard drive! The parameter conv=fsync forces a data buffer to write
to the device before dd returns.</p>
<p>After booting you can log in using a serial cable or over <em>ssh</em>. There is no
root password. That is because of the debug settings in <em>conf/local.conf</em>. If
you uncomment the line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1">#EXTRA_IMAGE_FEATURES = &quot;debug-tweaks&quot;</span>
</pre></div>
</div>
<p>the debug settings, like setting an empty root password, will not be applied.</p>
</section>
<section id="accessing-the-development-states-between-releases">
<h2><span class="section-number">9.3. </span>Accessing the Development States between Releases<a class="headerlink" href="#accessing-the-development-states-between-releases" title="Link to this heading"></a></h2>
<p>Special release manifests exist to give you access to the current development
states of the <em>Yocto</em> BSP. They will be displayed in the phyLinux selection
menu with the ending <em>PDXX.X.y</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>./phyLinux<span class="w"> </span>init<span class="w"> </span>-p<span class="w"> </span>imx8mp<span class="w"> </span>-r<span class="w"> </span>BSP-Yocto-Ampliphy-i.MX8MP-PD24.1.y
</pre></div>
</div>
<p>This will initialize a BSP that will track the latest development state.</p>
</section>
<section id="inspect-your-build-configuration">
<h2><span class="section-number">9.4. </span>Inspect your Build Configuration<a class="headerlink" href="#inspect-your-build-configuration" title="Link to this heading"></a></h2>
<p><em>Poky</em> includes several tools to inspect your build layout. You can inspect the
commands of the layer tool</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake-layers
</pre></div>
</div>
<p>It can, for example, be used to view in which layer a specific recipe gets
modified</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake-layers<span class="w"> </span>show-appends
</pre></div>
</div>
<p>Before running a build you can also launch <em>Toaster</em> to be able to inspect the
build details with the Toaster web GUI</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>toaster<span class="w"> </span>start
</pre></div>
</div>
<p>Maybe you need to install some requirements, first</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>pip3<span class="w"> </span>install<span class="w"> </span>-r
<span class="go">../sources/poky/bitbake/toaster-requirements.txt</span>
</pre></div>
</div>
<p>You can then point your browser to <em>http://0.0.0.0:8000/</em> and continue working
with <em>Bitbake</em>. All build activity can be monitored and analyzed from this web
server. If you want to learn more about <em>Toaster</em>, look at <a class="reference external" href="https://docs.yoctoproject.org/dev/toaster-manual/index.html">Toaster</a>.
To shut down the <em>Toaster</em> web GUI again, execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>toaster<span class="w"> </span>stop
</pre></div>
</div>
</section>
<section id="bsp-features-of-meta-phytec-and-meta-ampliphy">
<h2><span class="section-number">9.5. </span>BSP Features of meta-phytec and meta-ampliphy<a class="headerlink" href="#bsp-features-of-meta-phytec-and-meta-ampliphy" title="Link to this heading"></a></h2>
<section id="buildinfo">
<h3><span class="section-number">9.5.1. </span><em>Buildinfo</em><a class="headerlink" href="#buildinfo" title="Link to this heading"></a></h3>
<p>The <em>buildinfo</em> task is a feature in our recipes that prints instructions to
fetch the source code from the public repositories. So you do not have to look
into the recipes yourself. To see the instructions, e.g. for the <em>barebox</em>
package, execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>buildinfo
</pre></div>
</div>
<p>in your shell. This will print something like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(mini) HOWTO: Use a local git repository to build barebox:

To get source code for this package and version (barebox-2022.02.0-phy1), execute

$ mkdir -p ~/git
$ cd ~/git
$ git clone git://git.phytec.de/barebox barebox
$ cd ~/git/barebox
$ git switch -c v2022.02.0-phy1-local-development 7fe12e65d770f7e657e683849681f339a996418b

You now have two possible workflows for your changes:

1. Work inside the git repository:
Copy and paste the following snippet to your &quot;local.conf&quot;:

SRC_URI:pn-barebox = &quot;git://${HOME}/git/barebox;branch=${BRANCH}&quot;
SRCREV:pn-barebox = &quot;${AUTOREV}&quot;
BRANCH:pn-barebox = &quot;v2022.02.0-phy1-local-development&quot;

After that you can recompile and deploy the package with

$ bitbake barebox -c compile
$ bitbake barebox -c deploy

Note: You have to commit all your changes. Otherwise yocto doesn&#39;t pick them up!

2. Work and compile from the local working directory
To work and compile in an external source directory we provide the
externalsrc.bbclass. To use it, copy and paste the following snippet to your
&quot;local.conf&quot;:

INHERIT += &quot;externalsrc&quot;
EXTERNALSRC:pn-barebox = &quot;${HOME}/git/barebox&quot;
EXTERNALSRC_BUILD:pn-barebox = &quot;${HOME}/git/barebox&quot;

Note: All the compiling is done in the EXTERNALSRC directory. Every time
you build an Image, the package will be recompiled and build.

NOTE: Tasks Summary: Attempted 1 tasks of which 0 didn&#39;t need to be rerun and all succeeded.
NOTE: Writing buildhistory
</pre></div>
</div>
<p>As you can see, everything is explained in the output.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Using <em>externalsrc</em> breaks a lot of <em>Yocto’s</em> internal dependency
mechanisms. It is not guaranteed that any changes to the source
directory are automatically picked up by the build process and
incorporated into the root filesystem or SD card image. You have to
always use <em>–force</em>. E.g. to compile <em>barebox</em> and redeploy it to
<em>deploy/images/&lt;machine&gt;</em> execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>compile<span class="w"> </span>--force
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>deploy
</pre></div>
</div>
</div>
<p>To update the SD card image with a new kernel or image first force the
compilation of it and then force a rebuild of the root filesystem. Use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-qt6demo-image<span class="w"> </span>-c<span class="w"> </span>rootfs<span class="w"> </span>--force
</pre></div>
</div>
<p>Note that the build system is not modifying the external source directory. If
you want to apply all patches the <em>Yocto</em> recipe is carrying to the external
source directory, run the line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>SRCTREECOVEREDTASKS=&quot;&quot;<span class="w"> </span>BB_ENV_PASSTHROUGH_ADDITIONS=&quot;$BB_ENV_PASSTHROUGH_ADDITIONS<span class="w"> </span>SRCTREECOVEREDTASKS&quot;<span class="w"> </span>bitbake<span class="w"> </span>&lt;recipe&gt;<span class="w"> </span>-c<span class="w"> </span>patch
</pre></div>
</div>
</section>
</section>
<section id="bsp-customization">
<span id="scarthgap-bsp-customization"></span><h2><span class="section-number">9.6. </span>BSP Customization<a class="headerlink" href="#bsp-customization" title="Link to this heading"></a></h2>
<p>To get you started with the BSP, we have summarized some basic tasks from the
<em>Yocto</em> official documentation. It describes how to add additional software to
the image, change the kernel and bootloader configuration, and integrate
patches for the kernel and bootloader.</p>
<p>Minor modifications, such as adding software, are done in the file
<em>build/conf/local.conf</em>. There you can overwrite global configuration variables
and make small modifications to recipes.</p>
<p>There are 2 ways to make major changes:</p>
<ol class="arabic simple">
<li><p>Either create your own layer and use <em>bbappend</em> files.</p></li>
<li><p>Add everything to PHYTEC’s Distro layer <em>meta-ampliphy</em>.</p></li>
</ol>
<p>Creating your own layer is described in the section Create your own Layer.</p>
<section id="disable-qt-demo">
<h3><span class="section-number">9.6.1. </span>Disable Qt Demo<a class="headerlink" href="#disable-qt-demo" title="Link to this heading"></a></h3>
<p>By default, the BSP image <em>phytec-qt6demo-image</em> starts a Qt6 Demo application
on the attached display or monitor. If you want to stop the demo and use the
<em>Linux</em> framebuffer console behind it, connect to the target via serial cable
or <em>ssh</em> and execute the shell command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>stop<span class="w"> </span>phytec-qtdemo.service
</pre></div>
</div>
<p>This command stops the demo temporarily. To start it again, reboot the
board or execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>start<span class="w"> </span>phytec-qtdemo.service
</pre></div>
</div>
<p>You can disable the service permanently, so it does not start on boot</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>disable<span class="w"> </span>phytec-qtdemo.service
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The last command only disables the service. It does not <em>stop</em> immediately.
To see the current status execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>status<span class="w"> </span>phytec-qtdemo.service
</pre></div>
</div>
</div>
<p>If you want to disable the service by default, edit the file
<em>build/conf/local.conf</em> and add the following line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/local.conf</span>
SYSTEMD_AUTO_ENABLE:pn-phytec-qtdemo<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;disable&quot;</span>
</pre></div>
</div>
<p>After that, rebuild the image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-qt6demo-image
</pre></div>
</div>
</section>
<section id="framebuffer-console">
<h3><span class="section-number">9.6.2. </span>Framebuffer Console<a class="headerlink" href="#framebuffer-console" title="Link to this heading"></a></h3>
<p>On boards with a display interface, the framebuffer console is enabled per
default. You can attach a USB keyboard and log in. To change the keyboard
layout from the English default to German, type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>loadkeys<span class="w"> </span>/usr/share/keymaps/i386/qwertz/de-latin1.map.gz
</pre></div>
</div>
<p>To detach the framebuffer console, run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>sys/class/vtconsole/vtcon1/bind
</pre></div>
</div>
<p>To completely deactivate the framebuffer console, disable the following kernel
configuration option</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Device Drivers-&gt;Graphics Support-&gt;Support for framebuffer devices-&gt;Framebuffer Console Support
</pre></div>
</div>
<p>More information can be found at:
<a class="reference external" href="https://www.kernel.org/doc/Documentation/fb/fbcon.txt">https://www.kernel.org/doc/Documentation/fb/fbcon.txt</a></p>
</section>
<section id="tools-provided-in-the-prebuild-image">
<h3><span class="section-number">9.6.3. </span>Tools Provided in the Prebuild Image<a class="headerlink" href="#tools-provided-in-the-prebuild-image" title="Link to this heading"></a></h3>
<section id="ram-benchmark">
<h4><span class="section-number">9.6.3.1. </span>RAM Benchmark<a class="headerlink" href="#ram-benchmark" title="Link to this heading"></a></h4>
<p>Performing RAM and cache performance tests can best be done by using <em>pmbw</em>
(Parallel Memory Bandwidth Benchmark/Measurement Tool). <em>Pmbw</em> runs several
assembly routines which all use different access patterns to the caches and RAM
of the SoC. Before running the test, make sure that you have about 2 MiB of
space left on the device for the log files. We also lower the level of the
benchmark to ask the kernel more aggressively for resources. The benchmark test
will take several hours.</p>
<p>To start the test type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>nice<span class="w"> </span>-n<span class="w"> </span>-2<span class="w"> </span>pmbw
</pre></div>
</div>
<p>Upon completion of the test run, the log file can be converted to a <em>gnuplot</em>
script with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>stats2gnuplot<span class="w"> </span>stats.txt<span class="w"> </span>&gt;<span class="w"> </span>run1.gnuplot
</pre></div>
</div>
<p>Now you can transfer the file to the host machine and install any version of
<em>gnuplot</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>gnuplot<span class="w"> </span>host:~$<span class="w"> </span>gnuplot<span class="w"> </span>run1.gnuplot
</pre></div>
</div>
<p>The generated <em>plots-&lt;machine&gt;.pdf</em> file contains all plots. To render single
plots as <em>png</em> files for any web output you can use <em>Ghostscript</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ghostscript
<span class="gp">host:~$ </span>gs<span class="w"> </span>-dNOPAUSE<span class="w"> </span>-dBATCH<span class="w"> </span>-sDEVICE<span class="o">=</span>png16m<span class="w"> </span>-r150<span class="w"> </span>-sOutputFile<span class="o">=</span><span class="s1">&#39;page-%00d.png&#39;</span><span class="w"> </span>plots-phyboard-wega-am335x-1.pdf
</pre></div>
</div>
</section>
</section>
<section id="add-additional-software-for-the-bsp-image">
<h3><span class="section-number">9.6.4. </span>Add Additional Software for the BSP Image<a class="headerlink" href="#add-additional-software-for-the-bsp-image" title="Link to this heading"></a></h3>
<p>To add additional software to the image, look at the OpenEmbedded layer index:
<a class="reference external" href="https://layers.openembedded.org/layerindex/branch/scarthgap/layers/">layerindex</a></p>
<p>First, select the <em>Yocto</em> version of the BSP you have from the drop-down list in
the top left corner and click <strong>Recipes</strong>. Now you can search for a software
project name and find which layer it is in. In some cases, the program is in
<em>meta-openembedded</em>, <em>openembedded-core</em>, or <em>Poky</em> which means that the recipe
is already in your build tree. This section describes how to add additional
software when this is the case. If the package is in another layer, see the next
section.</p>
<p>You can also search the list of available recipes</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;program<span class="w"> </span>name&gt;<span class="w"> </span><span class="c1"># fill in program name, like in</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>lsof
</pre></div>
</div>
<p>When the recipe for the program is already in the <em>Yocto</em> build, you can simply
add it by appending a configuration option to your file <em>build/conf/local.conf</em>.
The general syntax to add additional software to an image is</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/local.conf</span>
IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; &lt;package1&gt; &lt;package2&gt;&quot;</span>
</pre></div>
</div>
<p>For example, the line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/local.conf</span>
IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; ldd strace file lsof&quot;</span>
</pre></div>
</div>
<p>installs some helper programs on the target image.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The leading whitespace is essential for the append command.</p>
</div>
<p>All configuration options in local.conf apply to all images. Consequently, the
tools are now included in both images phytec-headless-image and
phytec-qt6demo-image.</p>
<section id="notes-about-packages-and-recipes">
<h4><span class="section-number">9.6.4.1. </span>Notes about Packages and Recipes<a class="headerlink" href="#notes-about-packages-and-recipes" title="Link to this heading"></a></h4>
<p>You are adding packages to the IMAGE_INSTALL variable. Those are not necessarily
equivalent to the recipes in your meta-layers. A recipe defines per default a
package with the same name. But a recipe can set the PACKAGES variable to
something different and is able to generate packages with arbitrary names.
Whenever you look for software, you have to search for the package name and,
strictly speaking, not for the recipe. In the worst case, you have to look at
all PACKAGES variables. A tool such as <em>Toaster</em> can be helpful in some cases.</p>
<p>If you can not find your software in the layers provided in the folder
<em>sources</em>, see the next section to include another layer into the <em>Yocto</em>
build.</p>
<p>References: <a class="reference external" href="https://docs.yoctoproject.org/dev/singleindex.html#user-configuration">Yocto Documentation - Customizing Yocto builds</a></p>
</section>
</section>
<section id="add-an-additional-layer">
<h3><span class="section-number">9.6.5. </span>Add an Additional Layer<a class="headerlink" href="#add-an-additional-layer" title="Link to this heading"></a></h3>
<p>This is a step-by-step guide on how to add another layer to your <em>Yocto</em> build
and install additional software from it. As an example, we include the network
security scanner <em>nmap</em> in the layer <em>meta-security</em>. First, you must locate the
layer on which the software is hosted. Check out the <a class="reference external" href="https://layers.openembedded.org/layerindex/branch/scarthgap/layers/">layerindex</a>
and guess a little bit. The network scanner <em>nmap</em> is in the <em>meta-security</em>
layer. See <a class="reference external" href="https://layers.openembedded.org/layerindex/branch/scarthgap/layer/meta-security/">meta-security</a>.
To integrate it into the <em>Yocto</em> build, you have to check out the repository and
then switch to the correct stable branch. Since the BSP is based on the <em>Yocto</em>
Scarthgap build, you should try to use the Scarthgap branch in the
layer, too.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>sources
<span class="gp">host:~$ </span>git<span class="w"> </span>clone<span class="w"> </span>git://git.yoctoproject.org/meta-security
<span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>meta-security
<span class="gp">host:~$ </span>git<span class="w"> </span>branch<span class="w"> </span>-r
</pre></div>
</div>
<p>All available remote branches will show up. Usually there should be ‘sumo’,
‘warrior’, ‘zeus’, ‘dunfell’, ‘hardnkott’, ‘kirkstone’, ‘mickledore’, ‘master’…</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>git<span class="w"> </span>checkout<span class="w"> </span>scarthgap
</pre></div>
</div>
<p>Now we add the directory of the layer to the file <em>build/conf/bblayers.conf</em> by
appending the line</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/bblayers.conf</span>
BBLAYERS<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;${BSPDIR}/sources/meta-security&quot;</span>
</pre></div>
</div>
<p>to the end of the file. After that, you can check if the layer is available in
the build configuration by executing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake-layers<span class="w"> </span>show-layers
</pre></div>
</div>
<p>If there is an error like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ERROR: Layer &#39;security&#39; depends on layer &#39;perl-layer&#39;, but this layer is not enabled in your configuration
</pre></div>
</div>
<p>the layer that you want to add (here <em>meta-security</em>), depends on another layer,
which you need to enable first. E.g. the dependency required here is a layer in
<em>meta-openembedded</em> (in the PHYTEC BSP it is in the path
<em>sources/meta-openembedded/meta-perl/</em>). To enable it, add the following line to
<em>build/conf/bblayers.conf</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/bblayers.conf</span>
BBLAYERS<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;${BSPDIR}/sources/meta-openembedded/meta-perl&quot;</span>
</pre></div>
</div>
<p>Now the command <em>bitbake-layers show-layers</em> should print a list of all layers
enabled including <em>meta-security</em> and <em>meta-perl</em>. After the layer is included,
you can install additional software from it as already described above. The
easiest way is to add the following line (here is the package <em>nmap</em>)</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file build/conf/local.conf</span>
IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; nmap&quot;</span>
</pre></div>
</div>
<p>to your <em>build/conf/local.conf</em>. Do not forget to rebuild the image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-qt6demo-image
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>After adding further external or own layers, it makes sense to reflect
those additions by deriving a custom manifest file, cmp
<a class="reference internal" href="#scarthgap-phylinux-advanced-usage"><span class="std std-ref">Advanced Usage</span></a></p>
</div>
</section>
<section id="create-your-own-layer">
<h3><span class="section-number">9.6.6. </span>Create your own layer<a class="headerlink" href="#create-your-own-layer" title="Link to this heading"></a></h3>
<p>Creating your layer should be one of the first tasks when customizing the BSP.
You have two basic options. You can either copy and rename our <em>meta-ampliphy</em>,
or you can create a new layer that will contain your changes. The better option
depends on your use case. <em>meta-ampliphy</em> is our example of how to create a
custom <em>Linux</em> distribution that will be updated in the future. If you want to
benefit from those changes and are, in general, satisfied with the userspace
configuration, it could be the best solution to create your own layer on top of
<em>Ampliphy</em>. If you need to rework a lot of information and only need the basic
hardware support from PHYTEC, it would be better to copy <em>meta-ampliphy</em>, rename
it, and adapt it to your needs. You can also have a look at the OpenEmbedded
layer index to find different distribution layers. If you just need to add your
own application to the image, create your own layer.</p>
<p>In the following chapter, we have an embedded project called “racer” which we
will implement using our <em>Ampliphy Linux</em> distribution. First, we need to create
a new layer.</p>
<p><em>Yocto</em> provides a script for that. If you set up the BSP and the shell is
ready, type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake-layers<span class="w"> </span>create-layer<span class="w"> </span>meta-racer
</pre></div>
</div>
<p>Default options are fine for now. Move the layer to the source directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mv<span class="w"> </span>meta-racer<span class="w"> </span>../sources/
</pre></div>
</div>
<p>Create a <em>Git</em> repository in this layer to track your changes</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>../sources/meta-racer
<span class="gp">host:~$ </span>git<span class="w"> </span>init<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-s
</pre></div>
</div>
<p>Now you can add the layer directly to your build/conf/bblayers.conf</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>BBLAYERS<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;${BSPDIR}/sources/meta-racer&quot;</span>
</pre></div>
</div>
<p>or with a script provided by <em>Yocto</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake-layers<span class="w"> </span>add-layer<span class="w"> </span>meta-racer
</pre></div>
</div>
</section>
<section id="kernel-and-bootloader-recipe-and-version">
<h3><span class="section-number">9.6.7. </span>Kernel and Bootloader Recipe and Version<a class="headerlink" href="#kernel-and-bootloader-recipe-and-version" title="Link to this heading"></a></h3>
<p>First, you need to know which kernel and version are used for your target
machine. PHYTEC provides multiple kernel recipes <em>linux-mainline</em>, <em>linux-ti</em>
and <em>linux-imx</em>. The first one provides support for PHYTEC’s i.MX 6 and AM335x
modules and is based on the <em>Linux</em> kernel stable releases from <a class="reference external" href="https://kernel.org/">kernel.org</a>.
The <em>Git</em> repositories URLs are:</p>
<ul class="simple">
<li><p><em>linux-mainline</em>: git://git.phytec.de/linux-mainline</p></li>
<li><p><em>linux-ti</em>: git://git.phytec.de/linux-ti</p></li>
<li><p><em>linux-imx:</em> git://git.phytec.de/linux-imx</p></li>
<li><p><em>barebox</em>: git://git.phytec.de/barebox</p></li>
<li><p><em>u-boot-imx</em>: git://git.phytec.de/u-boot-imx</p></li>
</ul>
<p>To find your kernel provider, execute the following command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>virtual/kernel<span class="w"> </span>-e<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;PREFERRED_PROVIDER_virtual/kernel&quot;</span>
</pre></div>
</div>
<p>The command prints the value of the variable
<em>PREFERRED_PROVIDER_virtual/kernel</em>. The variable is used in the internal
<em>Yocto</em> build process to select the kernel recipe to use. The following lines
are different outputs you might see</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>PREFERRED_PROVIDER_virtual/kernel=&quot;linux-mainline&quot;
PREFERRED_PROVIDER_virtual/kernel=&quot;linux-ti&quot;
PREFERRED_PROVIDER_virtual/kernel=&quot;linux-imx&quot;
</pre></div>
</div>
<p>To see which version is used, execute <em>bitbake -s</em>. For example</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;linux-mainline|linux-ti|linux-imx|barebox|u-boot-imx&quot;</span>
</pre></div>
</div>
<p>The parameter <em>-s</em> prints the version of all recipes. The output contains the
recipe name on the left and the version on the right</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>barebox                      :2022.02.0-phy1-r7.0
barebox-hosttools-native     :2022.02.0-phy1-r7.0
barebox-targettools          :2022.02.0-phy1-r7.0
linux-mainline               :5.15.102-phy1-r0.0
</pre></div>
</div>
<p>As you can see, the recipe <em>linux-mainline</em> has version <em>5.15.102-phy1</em>. In
the PHYTEC’s <em>linux-mainline</em>  <em>Git</em> repository, you will find a corresponding
tag <em>v5.15.102-phy1</em>. The version of the <em>barebox</em> recipe is 2022.02.0-phy1.
On i.MX8M* modules the output will contain <em>linux-imx</em> and <em>u-boot-imx</em>.</p>
</section>
<section id="kernel-and-bootloader-configuration">
<span id="yocto-man-scarthgap-kernel-and-bootloader-conf"></span><h3><span class="section-number">9.6.8. </span>Kernel and Bootloader Configuration<a class="headerlink" href="#kernel-and-bootloader-configuration" title="Link to this heading"></a></h3>
<p>The bootloader used by PHYTEC, <em>barebox</em>, uses the same build system as the
<em>Linux</em> kernel. Therefore, all commands in this section can be used to configure
the kernel and bootloader. To configure the kernel or bootloader, execute one of
the following commands</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>virtual/kernel<span class="w">  </span><span class="c1"># Using the virtual provider name</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>linux-ti<span class="w">        </span><span class="c1"># Or use the recipe name directly</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>linux-mainline<span class="w">  </span><span class="c1"># Or use the recipe name directly (If you use an i.MX 6 or RK3288 Module)</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>linux-imx<span class="w">       </span><span class="c1"># Or use the recipe name directly (If you use an i.MX 8M*)</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>barebox<span class="w">         </span><span class="c1"># Or change the configuration of the bootloader</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span>u-boot-imx<span class="w">      </span><span class="c1"># Or change the configuration of the bootloader (If you use an i.MX 8M*)</span>
</pre></div>
</div>
<p>After that, you can recompile and redeploy the kernel or bootloader</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>virtual/kernel<span class="w"> </span>-c<span class="w"> </span>compile<span class="w">  </span><span class="c1"># Or &#39;barebox&#39; for the bootloader</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>virtual/kernel<span class="w"> </span>-c<span class="w"> </span>deploy<span class="w">   </span><span class="c1"># Or &#39;barebox&#39; for the bootloader</span>
</pre></div>
</div>
<p>Instead, you can also just rebuild the complete build output with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w">  </span><span class="c1"># To update the kernel/bootloader, modules and the images</span>
</pre></div>
</div>
<p>In the last command, you can replace the image name with the name of an image of
your choice. The new images and binaries are in
<em>build/deploy/images/&lt;machine&gt;/</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The build configuration is not permanent yet. Executing <em>bitbake
virtual/kernel -c clean</em> will remove everything.</p>
</div>
<p>To make your changes permanent in the build system, you have to integrate your
configuration modifications into a layer. For the configuration you have two
options:</p>
<ul class="simple">
<li><p>Include only a configuration fragment (a minimal <em>diff</em> between the
old and new configuration)</p></li>
<li><p>Complete default configuration (<em>defconfig</em>) after your
modifications.</p></li>
</ul>
<p>Having a set of configuration fragments makes what was changed at which stage
more transparent. You can turn on and off the changes, you can manage
configurations for different situations and it helps when porting changes to new
kernel versions. You can also group changes together to reflect specific use
cases. A fully assembled kernel configuration will be deployed in the directory
<em>build/deploy/images/&lt;machine&gt;</em>. If you do not have any of those requirements,
it might be simpler to just manage a separate <em>defconfig</em> file.</p>
<section id="add-a-configuration-fragment-to-a-recipe">
<h4><span class="section-number">9.6.8.1. </span>Add a Configuration Fragment to a Recipe<a class="headerlink" href="#add-a-configuration-fragment-to-a-recipe" title="Link to this heading"></a></h4>
<p>The following steps can be used for both kernel and bootloader. Just replace the
recipe name <em>linux-mainline</em> in the commands with <em>linux-ti</em>, or <em>barebox</em> for
the bootloader. If you did not already take care of this, start with a clean
build. Otherwise, the diff of the configuration may be wrong</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-mainline<span class="w"> </span>-c<span class="w"> </span>clean
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-mainline<span class="w"> </span>-c<span class="w"> </span>menuconfig
</pre></div>
</div>
<p>Make your configuration changes in the menu and generate a config
fragment</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-mainline<span class="w"> </span>-c<span class="w"> </span>diffconfig
</pre></div>
</div>
<p>which prints the path of the written file</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Config fragment has been dumped into:
/home/&lt;path&gt;/build/tmp/work/phyboard_mira_imx6_11-phytec-linux-gnueabi/linux-mainline/4.19.100-phy1-r0.0/fragment.cfg
</pre></div>
</div>
<p>All config changes are in the file <em>fragment.cfg</em> which should consist of only
some lines. The following example shows how to create a <em>bbappend</em> file and how
to add the necessary lines for the config fragment. You just have to adjust the
directories and names for the specific recipe: <em>linux-mainline</em>, <em>linux-ti</em>,
linux-imx, u-boot-imx, or <em>barebox</em>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sources/&lt;layer&gt;/recipes-kernel/linux/linux-mainline_%.bbappend     # For the recipe linux-mainline
sources/&lt;layer&gt;/recipes-kernel/linux/linux-ti_%.bbappend           # For the recipe linux-ti
sources/&lt;layer&gt;/recipes-kernel/linux/linux-imx_%.bbappend          # For the recipe linux-imx
sources/&lt;layer&gt;/recipes-bsp/barebox/barebox_%.bbappend             # For the recipe barebox
sources/&lt;layer&gt;/recipes-bsp/u-boot/u-boot-imx_%.bbappend           # For the recipe u-boot-imx
</pre></div>
</div>
<p>Replace the string <em>layer</em> with your own layer created as shown above (e.g.
<em>meta-racer</em>), or just use <em>meta-ampliphy</em>. To use <em>meta-ampliphy</em>, first,
create the directory for the config fragment and give it a new name (here
<em>enable-r8169.cfg</em>) and move the fragment to the layer.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>sources/meta-ampliphy/recipes-kernel/linux/features
<span class="gp"># </span>copy<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>*diffconfig*
<span class="gp">host:~$ </span>cp<span class="w"> </span>/home/&lt;path&gt;/build/tmp/work/phyboard_mira_imx6_11-phytec-linux-gnueabi/linux-mainline/4.19.100-phy1-r0.0/fragment.cfg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sources/meta-ampliphy/recipes-kernel/linux/features/enable-r8169.cfg
</pre></div>
</div>
<p>Then open the <em>bbappend</em> file (in this case
<em>sources/meta-ampliphy/recipes-kernel/linux/linux-mainline_%.bbappend</em> ) with
your favorite editor and add the following lines</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the file linux-mainline_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/features:&quot;</span>
SRC_URI:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \</span>
<span class="s2">    file://enable-r8169.cfg \</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not forget to use the correct <em>bbappend</em> filenames: <em>linux-ti_%.bbappend</em>
for the linux-ti recipe and <em>barebox_%.bbappend</em> for the bootloader in the
folder <em>recipes-bsp/barebox/</em> !</p>
</div>
<p>After saving the <em>bbappend</em> file, you have to rebuild the image. <em>Yocto</em> should
pick up the recipe changes automatically and generate a new image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span><span class="c1"># Or another image name</span>
</pre></div>
</div>
</section>
<section id="add-a-complete-default-configuration-defconfig-to-a-recipe">
<h4><span class="section-number">9.6.8.2. </span>Add a Complete Default Configuration (<em>defconfig</em>) to a Recipe<a class="headerlink" href="#add-a-complete-default-configuration-defconfig-to-a-recipe" title="Link to this heading"></a></h4>
<p>This approach is similar to the one above, but instead of adding a fragment, a
<em>defconfig</em> is used. First, create the necessary folders in the layer you want
to use, either your own layer or <em>meta-ampliphy</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>sources/meta-ampliphy/recipes-kernel/linux/features/<span class="w"> </span><span class="c1"># For both linux-mainline and linux-ti</span>
<span class="gp">host:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>sources/meta-ampliphy/recipes-bsp/barebox/features/<span class="w"> </span><span class="c1"># Or for the bootloader</span>
</pre></div>
</div>
<p>Then you have to create a suitable <em>defconfig</em> file. Make your configuration
changes using <em>menuconfig</em> and then save the <em>defconfig</em> file to the layer</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-mainline<span class="w"> </span>-c<span class="w"> </span>menuconfig<span class="w"> </span><span class="c1"># Or use recipe name linux-ti or barebox</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-mainline<span class="w"> </span>-c<span class="w"> </span>savedefconfig<span class="w"> </span><span class="c1"># Create file &#39;defconfig.temp&#39; in the work directory</span>
</pre></div>
</div>
<p>This will print the path to the generated file</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Saving defconfig to ..../defconfig.temp
</pre></div>
</div>
<p>Then, as above, copy the generated file to your layer, rename it to <em>defconfig</em>,
and add the following lines to the <em>bbappend</em> file (here
<em>sources/meta-ampliphy/recipes-kernel/linux/linux-mainline_%.bbappend</em>)</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the file linux-mainline_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/features:&quot;</span>
SRC_URI:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \</span>
<span class="s2">    file://defconfig \</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Do not forget to use the correct bbappend filenames: <em>linux-ti_%.bbappend</em>
for the linux-ti recipe and <em>barebox_%.bbappend</em> for the bootloader in the
folder <em>recipes-bsp/barebox/</em> !</p>
</div>
<p>After that, rebuild your image as the changes are picked up automatically</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span><span class="c1"># Or another image name</span>
</pre></div>
</div>
</section>
</section>
<section id="patch-the-kernel-or-bootloader-with-devtool">
<span id="scarthgap-temporary-method"></span><h3><span class="section-number">9.6.9. </span>Patch the Kernel or Bootloader with <em>devtool</em><a class="headerlink" href="#patch-the-kernel-or-bootloader-with-devtool" title="Link to this heading"></a></h3>
<p><em>Apart from using the standard versions of kernel and bootloader which are
provided in the recipes, you can modify the source code or use our own
repositories to build your customized kernel.</em></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>PRO</p></td>
<td><p>CON</p></td>
</tr>
<tr class="row-even"><td><p>Standard workflow of the
official <em>Yocto</em> documentation</p></td>
<td><p>Uses additional hard drive space
as the sources get duplicated</p></td>
</tr>
<tr class="row-odd"><td><p>Toolchain does not have to
recompile everything</p></td>
<td><p>No optimal cache usage, build
overhead</p></td>
</tr>
</tbody>
</table>
<p><em>Devtool</em> is a set of helper scripts to enhance the user workflow of <em>Yocto</em>. It
was integrated with version 1.8. It is available as soon as you set up your
shell environment. <em>Devtool</em> can be used to:</p>
<ul class="simple">
<li><p>modify existing sources</p></li>
<li><p>integrate software projects into your build setup</p></li>
<li><p>build software and deploy software modifications to your target</p></li>
</ul>
<p>Here we will use <em>devtool</em> to patch the kernel. We use <em>linux-mainline</em> as an
example for the AM335x Kernel. The first command we use is <em>devtool modify - x
&lt;recipe&gt; &lt;directory&gt;</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>devtool<span class="w"> </span>modify<span class="w"> </span>-x<span class="w"> </span>linux-mainline<span class="w"> </span>linux-mainline
</pre></div>
</div>
<p><em>Devtool</em> will create a layer in <em>build/workspace</em> where you can see all
modifications done by <em>devtool</em> . It will extract the sources corresponding to
the recipe to the specified directory. A <em>bbappend</em> will be created in the
workspace directing the SRC_URI to this directory. Building an image with
<em>Bitbake</em> will now use the sources in this directory. Now you can modify lines
in the kernel</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>vim<span class="w"> </span>linux-mainline/arch/arm/boot/dts/am335x-phycore-som.dtsi
<span class="go">      -&gt; make a change</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-qt6demo-image
</pre></div>
</div>
<p>Your changes will now be recompiled and added to the image. If you want to store
your changes permanently, it is advisable to create a patch from the changes,
then store and backup only the patch. You can go into the <em>linux-mainline</em>
directory and create a patch using <em>Git</em>. How to create a patch is described in
<a class="reference internal" href="#scarthgap-temporary-method"><span class="std std-ref">Patch the Kernel or Bootloader with devtool</span></a>
and is the same for all methods.</p>
<p>If you want to learn more about <em>devtool</em>, visit:</p>
<p><a class="reference external" href="https://docs.yoctoproject.org/dev/sdk-manual/extensible.html#using-devtool-in-your-sdk-workflow">Yocto - Devtool</a> or <a class="reference external" href="https://docs.yoctoproject.org/dev/ref-manual/devtool-reference.html">Devtool Quick Reference</a>.</p>
</section>
<section id="patch-the-kernel-or-bootloader-using-the-temporary-method">
<h3><span class="section-number">9.6.10. </span>Patch the Kernel or Bootloader using the “Temporary Method”<a class="headerlink" href="#patch-the-kernel-or-bootloader-using-the-temporary-method" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>PRO</p></td>
<td><p>CON</p></td>
</tr>
<tr class="row-even"><td><p>No overhead, no extra
configuration</p></td>
<td><p>Changes are easily overwritten
by <em>Yocto</em> (Everything is
lost!!).</p></td>
</tr>
<tr class="row-odd"><td><p>Toolchain does not have to
recompile everything</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>It is possible to alter the source code before <em>Bitbake</em> configures and compiles
the recipe. Use <em>Bitbake’</em> s <em>devshell</em> command to jump into the source
directory of the recipe. Here is the <em>barebox</em> recipe</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>devshell<span class="w"> </span><span class="c1"># or linux-mainline, linux-ti, linux-imx, u-boot-imx</span>
</pre></div>
</div>
<p>After executing the command, a shell window opens. The current working directory
of the shell will be changed to the source directory of the recipe inside the
<em>tmp</em> folder. Here you can use your favorite editor, e.g. <em>vim</em>, <em>emacs</em>, or any
other graphical editor, to alter the source code. When you are finished, exit
the <em>devshell</em> by typing <em>exit</em> or hitting <strong>CTRL-D</strong>.</p>
<p>After leaving the <em>devshell</em> you can recompile the package</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>compile<span class="w"> </span>--force<span class="w"> </span><span class="c1"># or linux-mainline, linux-ti, linux-imx, u-boot-imx</span>
</pre></div>
</div>
<p>The extra argument ‘–force’ is important because <em>Yocto</em> does not recognize
that the source code was changed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You cannot execute the <em>bitbake</em> command in the <em>devshell</em> . You have
to leave it first.</p>
</div>
<p>If the build fails, execute the devshell command again and fix it. If the build
is successful, you can deploy the package and create a new SD card image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>deploy<span class="w"> </span><span class="c1"># new barebox in e.g. deploy/images/phyflex-imx6-2/barebox.bin</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span><span class="c1"># new WIC image in e.g. deploy/images/phyflex-imx6-2/phytec-headless-image-phyflex-imx6-2.wic</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you execute a clean e.g <em>bitbake barebox -c clean</em> , or if <em>Yocto</em> fetches
the source code again, all your changes are lost!!!</p>
<p>To avoid this, you can create a patch and add it to a <em>bbappend</em> file. It is
the same workflow as described in the section about changing the
configuration.</p>
<p>You have to create the patch in the <em>devshell</em> if you use the temporary
method and in the subdirectory created by <em>devtool</em> if you used <em>devtool</em>.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>devshell<span class="w">            </span><span class="c1"># Or linux-mainline, linux-ti</span>
<span class="gp">host(devshell):~$ </span>git<span class="w"> </span>status<span class="w">                   </span><span class="c1"># Show changes files</span>
<span class="gp">host(devshell):~$ </span>git<span class="w"> </span>add<span class="w"> </span>&lt;file&gt;<span class="w">               </span><span class="c1"># Add a special file to the staging area</span>
<span class="gp">host(devshell):~$ </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;important modification&quot;</span><span class="w">   </span><span class="c1"># Creates a commit with a not so useful commit message</span>
<span class="gp">host(devshell):~$ </span>git<span class="w"> </span>format-patch<span class="w"> </span>-1<span class="w"> </span>-o<span class="w"> </span>~/<span class="w">    </span><span class="c1"># Creates a patch of the last commit and saves it in your home folder</span>
<span class="go">/home/&lt;user&gt;/0001-important-modification.patch  # Git prints the path of the written patch file</span>
<span class="gp">host(devshell):~$ </span><span class="nb">exit</span>
</pre></div>
</div>
<p>After you have created the patch, you must create a <em>bbappend</em> file for it. The
locations for the three different recipes - <em>linux-mainline</em> , <em>linux-ti</em> , and
<em>barebox</em> - are</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sources/&lt;layer&gt;/recipes-kernel/linux/linux-mainline_%.bbappend     # For the recipe linux-mainline
sources/&lt;layer&gt;/recipes-kernel/linux/linux-ti_%.bbappend           # For the recipe linux-ti
sources/&lt;layer&gt;/recipes-kernel/linux/linux-imx_%.bbappend        # For the recipe linux-imx
sources/&lt;layer&gt;/recipes-bsp/barebox/barebox_%.bbappend             # For the recipe barebox
sources/&lt;layer&gt;/recipes-bsp/u-boot/u-boot-imx_%.bbappend           # For the recipe u-boot-imx
</pre></div>
</div>
<p>The following example is for the recipe <em>barebox</em>. You have to adjust the paths.
First, create the folders and move the patch into them. Then create the
<em>bbappend</em> file</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>sources/meta-ampliphy/recipes-bsp/barebox/features<span class="w">   </span><span class="c1"># Or use your own layer instead of *meta-ampliphy*</span>
<span class="gp">host:~$ </span>cp<span class="w"> </span>~/0001-important-modification.patch<span class="w"> </span>sources/meta-ampliphy/recipes-bsp/barebox/features<span class="w">  </span><span class="c1"># copy patch</span>
<span class="gp">host:~$ </span>touch<span class="w"> </span>sources/meta-ampliphy/recipes-bsp/barebox/barebox_%.bbappend
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Pay attention to your current work directory. You have to execute the
commands in the BSP top-level directory. Not in the <em>build</em> directory!</p>
</div>
<p>After that use your favorite editor to add the following snipped into the
<em>bbappend</em> file (here
<em>sources/meta-ampliphy/recipes-bsp/barebox/barebox_%.bbappend</em>)</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the file barebox_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/features:&quot;</span>
SRC_URI:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \</span>
<span class="s2">    file://0001-important-modification.patch \</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
<p>Save the file and rebuild the <em>barebox</em> recipe with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>clean<span class="w"> </span><span class="c1"># Or linux-ti, linux-mainline, linux-imx, u-boot-imx</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox
</pre></div>
</div>
<p>If the build is successful, you can rebuild the final image with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span><span class="c1"># Or another image name</span>
</pre></div>
</div>
<p><strong>Further Resources:</strong></p>
<p>The <em>Yocto</em> Project has some documentation for software developers. Check the
‘Kernel Development Manual’ for more information about how to configure the
kernel. Please note that not all of the information from the <em>Yocto</em> manual can
be applied to the PHYTEC BSP as we use the classic kernel approach of <em>Yocto</em>
and most of the documentation assumes the <em>Yocto</em> kernel approach.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.yoctoproject.org/dev/kernel-dev/index.html">Yocto - Kernel Development Manual</a></p></li>
<li><p><a class="reference external" href="https://docs.yoctoproject.org/dev/dev-manual/index.html">Yocto - Development Manual</a></p></li>
</ul>
</section>
<section id="working-with-the-kernel-and-bootloader-using-src-uri-in-local-conf">
<h3><span class="section-number">9.6.11. </span>Working with the Kernel and Bootloader using SRC_URI in <em>local.conf</em><a class="headerlink" href="#working-with-the-kernel-and-bootloader-using-src-uri-in-local-conf" title="Link to this heading"></a></h3>
<p><em>Here we present a third option to make kernel and bootloader changes. You have
external checkouts of the linux-mainline, linux-ti, or barebox  Git
repositories. You will overwrite the URL of the source code fetcher, the
variable SRC_URI, to point to your local checkout instead of the remote
repositories.</em></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>PRO</p></td>
<td><p>CON</p></td>
</tr>
<tr class="row-even"><td><p>All changes are saved with
<em>Git</em></p></td>
<td><p>Many working directories in
<em>build/tmp-glibc/work/&lt;machine&gt;/&lt;package&gt;/</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>You have to commit every change
before recompiling</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>For each change, the toolchain
compiles everything from scratch
(avoidable with <em>ccache</em>)</p></td>
</tr>
</tbody>
</table>
<p>First, you need a local clone of the <em>Git</em> repository <em>barebox</em> or
kernel. If you do not have one, use the commands</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>mkdir<span class="w"> </span>~/git
<span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>~/git
<span class="gp">host:~$ </span>git<span class="w"> </span>clone<span class="w"> </span>git://git.phytec.de/barebox
<span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>barebox
<span class="gp">host:~$ </span>git<span class="w"> </span>switch<span class="w"> </span>-c<span class="w"> </span>v2022.02.0-phy<span class="w"> </span>remotes/origin/v2022.02.0-phy
</pre></div>
</div>
<p>Add the following snippet to the file build/conf/local.conf</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use your own path to the git repository</span>
<span class="c1"># NOTE: Branch name in variable &quot;BRANCH_pn-barebox&quot; should be the same as the</span>
<span class="c1"># branch which is used in the repository folder. Otherwise your commits won&#39;t be recognized later.</span>
BRANCH:pn-barebox<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;v2022.02.0-phy&quot;</span>
SRC_URI:pn-barebox<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;git:///${HOME}/git/barebox;branch=${BRANCH}&quot;</span>
SRCREV:pn-barebox<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${AUTOREV}&quot;</span>
</pre></div>
</div>
<p>You also have to set the correct BRANCH name in the file. Either you create your
own branch in the <em>Git</em> repository, or you use the default (here
“v2015.02.0-phy”). Now you should recompile <em>barebox</em> from your own source</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>clean
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>compile
</pre></div>
</div>
<p>The build should be successful because the source was not changed yet.</p>
<p>You can alter the source in <em>~/git/barebox</em> or the default <em>defconfig</em> (e.g.
<em>~/git/barebox/arch/arm/configs/imx_v7_defconfig</em>). After you are satisfied with
your changes, you have to make a dummy commit for <em>Yocto</em>. If you do not,
<em>Yocto</em> will not notice that the source code was modified in your repository
folder (e.g. ~/git/barebox/)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>git<span class="w"> </span>status<span class="w">  </span><span class="c1"># show modified files</span>
<span class="gp">host:~$ </span>git<span class="w"> </span>diff<span class="w">    </span><span class="c1"># show changed lines</span>
<span class="gp">host:~$ </span>git<span class="w"> </span>commit<span class="w"> </span>-a<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;dummy commit for yocto&quot;</span><span class="w">   </span><span class="c1"># This command is important!</span>
</pre></div>
</div>
<p>Try to compile your new changes. <em>Yocto</em> will automatically notice that the
source code was changed and fetches and configures everything from scratch.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>compile
</pre></div>
</div>
<p>If the build fails, go back to the source directory, fix the problem, and
recommit your changes. If the build was successful, you can deploy <em>barebox</em> and
even create a new SD card image.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>deploy<span class="w"> </span><span class="c1"># new barebox in e.g. deploy/images/phyflex-imx6-2/barebox-phyflex-imx6-2.bin</span>
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span><span class="c1"># new sd-card image in e.g. deploy/images/phyflex-imx6-2/phytec-headless-image-phyflex-imx6-2.wic</span>
</pre></div>
</div>
<p>If you want to make additional changes, just make another commit in the
repository and rebuild <em>barebox</em> again.</p>
</section>
<section id="add-existing-software-with-sustainable-method">
<h3><span class="section-number">9.6.12. </span>Add Existing Software with “Sustainable Method”<a class="headerlink" href="#add-existing-software-with-sustainable-method" title="Link to this heading"></a></h3>
<p>Now that you have created your own layer, you have a second option to add
existing software to existing image definitions. Our standard image is defined
in meta-ampliphy</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>meta-ampliphy/recipes-images/images/phytec-headless-image.bb
</pre></div>
</div>
<p>In your layer, you can now modify the recipe with a <em>bbappend</em> without modifying
any BSP code</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>meta-racer/recipes-images/images/phytec-headless-image.bbappend
</pre></div>
</div>
<p>The append will be parsed together with the base recipe. As a result, you can
easily overwrite all variables set in the base recipe, which is not always what
you want. If we want to include additional software, we need to append it to the
IMAGE_INSTALL variable</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; rsync&quot;</span>
</pre></div>
</div>
</section>
<section id="add-linux-firmware-files-to-the-root-filesystem">
<h3><span class="section-number">9.6.13. </span>Add Linux Firmware Files to the Root Filesystem<a class="headerlink" href="#add-linux-firmware-files-to-the-root-filesystem" title="Link to this heading"></a></h3>
<p>It is a common task to add an extra firmware file to your root filesystem into
<em>/lib/firmware/</em>. For example, WiFi adapters or PCIe Ethernet cards might need
proprietary firmware. As a solution, we use a <em>bbappend</em> in our layer. To create
the necessary folders, <em>bbappend</em> and copy the firmware file type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">cd</span><span class="w"> </span>meta-racer<span class="w">   </span><span class="c1"># go into your layer</span>
<span class="gp">host:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>recipes-kernel/linux-firmware/linux-firmware/
<span class="gp">host:~$ </span>touch<span class="w"> </span>recipes-kernel/linux-firmware/linux-firmware_%.bbappend
<span class="gp">host:~$ </span>cp<span class="w"> </span>~/example-firmware.bin<span class="w"> </span>recipes-kernel/linux-firmware/linux-firmware/<span class="w">    </span><span class="c1"># adapt filename</span>
</pre></div>
</div>
<p>Then add the following content to the <em>bbappend</em> file and replace every
occurrence of <em>example-firmware.bin</em> with your firmware file name.</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file recipes-kernel/linux-firmware/linux-firmware_%.bbappend</span>

FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/linux-firmware:&quot;</span>
SRC_URI<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;file://example-firmware.bin&quot;</span>

do_install:append<span class="w"> </span><span class="p">()</span><span class="w"> </span>{
<span class="w">        </span>install<span class="w"> </span>-m<span class="w"> </span><span class="mi">0644</span><span class="w"> </span>${WORKDIR}/example-firmware.bin<span class="w"> </span>${D}/lib/firmware/example-firmware.bin
}

<span class="c1"># NOTE: Use &quot;=+&quot; instead of &quot;+=&quot;. Otherwise file is placed into the linux-firmware package.</span>
PACKAGES<span class="w"> </span><span class="o">=</span>+<span class="w"> </span><span class="s2">&quot;${PN}-example&quot;</span>
FILES:${PN}-example<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/lib/firmware/example-firmware.bin&quot;</span>
</pre></div>
</div>
<p>Now try to build the linux-firmware recipe</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>.<span class="w"> </span>sources/poky/oe-init-build-env
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>linux-firmware
</pre></div>
</div>
<p>This should generate a new package <em>deploy/ipk/all/linux-firmware-example</em>.</p>
<p>As the final step, you have to install the firmware package to your image. You
can do that in your <em>local.conf</em> or image recipe via</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file local.conf or image recipe</span>
IMAGE_INSTALL<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;linux-firmware-example&quot;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ensure that you have adapted the package name <em>linux-firmware-example</em> with
the name you assigned in <em>linux-firmware_%.bbappend</em>.</p>
</div>
</section>
<section id="change-the-u-boot-environment-via-bbappend-files">
<h3><span class="section-number">9.6.14. </span>Change the <em>u-boot</em> Environment via <em>bbappend</em> Files<a class="headerlink" href="#change-the-u-boot-environment-via-bbappend-files" title="Link to this heading"></a></h3>
<p>All i.MX8M* products use the u-boot bootloader. The u-boot environment can be
modified using the Temporary Method. In the <em>u-boot-imx</em> sources modify the
header file corresponding to the processor located in
<em>include/configs/phycore_imx8m*</em>. New environment variables should be added at
the end of <em>CONFIG_EXTRA_ENV_SETTINGS</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1">#define CONFIG_EXTRA_ENV_SETTINGS \</span>
[...]
PHYCORE_FITIMAGE_ENV_BOOTLOGIC<span class="w"> </span>\
<span class="s2">&quot;newvariable=1\0&quot;</span>
</pre></div>
</div>
<p>Commit the changes and and create the file <em>u-boot-imx_%.bbappend</em> in your layer
at <em>&lt;layer&gt;/recipes-bsp/u-boot/u-boot-imx_%.bbappend</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># contents of the file u-boot-imx_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/features:&quot;</span>
SRC_URI:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \</span>
<span class="s2">    file://0001-environment-addition.patch \</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="change-the-barebox-environment-via-bbappend-files">
<h3><span class="section-number">9.6.15. </span>Change the <em>barebox</em> Environment via <em>bbappend</em> Files<a class="headerlink" href="#change-the-barebox-environment-via-bbappend-files" title="Link to this heading"></a></h3>
<p>Since <em>BSP-Yocto-AM335x-16.2.0</em> and <em>BSP-Yocto-i.MX6-PD16.1.0</em>, the <em>barebox</em>
environment handling in <em>meta-phytec</em> has changed. Now it is possible to add,
change, and remove files in the <em>barebox</em> environment via the <em>Python</em> bitbake
task <em>do_env</em>. There are two <em>Python</em> functions to change the environment. Their
signatures are:</p>
<ul class="simple">
<li><p><em>env_add(d, ***filename as string*</em><em>, ***file content as string*</em><em>)</em>:
to add a new file or overwrite an existing file</p></li>
<li><p><em>env_rm(d, ***filename as string*</em><em>)</em>: to remove a file</p></li>
</ul>
<p>The first example of a <em>bbappend</em> file in the custom layer <em>meta-racer</em> shows
how to add a new non-volatile variable <em>linux.bootargs.fb</em> in the <em>barebox</em>
environment folder <em>/env/nv/</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file meta-racer/recipes-bsp/barebox/barebox_2022.02.0-phy1.bbappend</span>
python<span class="w"> </span>do_env:append()<span class="w"> </span>{
<span class="w">    </span>env_add(d,<span class="w"> </span><span class="s2">&quot;nv/linux.bootargs.fb&quot;</span>,<span class="w"> </span><span class="s2">&quot;imxdrm.legacyfb_depth=32\n&quot;</span><span class="p">)</span>
}
</pre></div>
</div>
<p>The next example shows how to replace the network configuration file
<em>/env/network/eth0</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file meta-racer/recipes-bsp/barebox/barebox_2022.02.0-phy1.bbappend</span>
python<span class="w"> </span>do_env:append()<span class="w"> </span>{
<span class="w">    </span>env_add(d,<span class="w"> </span><span class="s2">&quot;network/eth0&quot;</span>,
<span class="s2">&quot;&quot;&quot;#!/bin/sh</span>

<span class="s2"># ip setting (static/dhcp)</span>
<span class="s2">ip=static</span>
<span class="s2">global.dhcp.vendor_id=barebox-${global.hostname}</span>

<span class="s2"># static setup used if ip=static</span>
<span class="s2">ipaddr=192.168.178.5</span>
<span class="s2">netmask=255.255.255.0</span>
<span class="s2">gateway=192.168.178.1</span>
<span class="s2">serverip=192.168.178.1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
}
</pre></div>
</div>
<p>In the above example, the <em>Python</em> multiline string syntax <strong>“”” text “””</strong> is
used to avoid adding multiple newline characters <em>\n</em> into the recipe <em>Python</em>
code. The <em>Python</em> function <em>env_add</em> can add and overwrite environment files.</p>
<p>The next example shows how to remove an already added environment file, for
example <em>,</em> <em>/env/boot/mmc</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file meta-racer/recipes-bsp/barebox/barebox_2022.02.0-phy1.bbappend</span>
python<span class="w"> </span>do_env:append()<span class="w"> </span>{
<span class="w">    </span>env_rm(d,<span class="w"> </span><span class="s2">&quot;boot/mmc&quot;</span><span class="p">)</span>
}
</pre></div>
</div>
<section id="debugging-the-environment">
<h4><span class="section-number">9.6.15.1. </span>Debugging the Environment<a class="headerlink" href="#debugging-the-environment" title="Link to this heading"></a></h4>
<p>If you want to see all environment files that are added in the build process,
you can enable a debug flag in the <em>local.conf</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file local.conf</span>
ENV_VERBOSE<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>After that, you have to rebuild the <em>barebox</em> recipe to see the debugging
output</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>clean
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>barebox<span class="w"> </span>-c<span class="w"> </span>configure
</pre></div>
</div>
<p>The output of the last command looks like this</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[...]
WARNING: barebox-2022.02.0-phy1-r7.0 do_env_write: File &#39;nv/allow_color&#39; content &quot;false&quot;
WARNING: barebox-2022.02.0-phy1-r7.0 do_env_write: File &#39;nv/linux.bootargs.base&#39; content &quot;consoleblank=0&quot;
WARNING: barebox-2022.02.0-phy1-r7.0 do_env_write: File &#39;nv/linux.bootargs.fb&#39; content &quot;imxdrm.legacyfb_depth=32&quot;
WARNING: barebox-2022.02.0-phy1-r7.0 do_env_write: File &#39;nv/linux.bootargs.rootfs&#39; content &quot;rootwait ro fsck.repair=yes&quot;
</pre></div>
</div>
</section>
<section id="changing-the-environment-depending-on-machines">
<h4><span class="section-number">9.6.15.2. </span>Changing the Environment (depending on Machines)<a class="headerlink" href="#changing-the-environment-depending-on-machines" title="Link to this heading"></a></h4>
<p>If you need to apply some <em>barebox</em> environment modifications only to a single
or only a few machines, you can use <em>Bitbake’</em> s machine overwrite syntax. For
the machine overwrite syntax, you append a machine name or SoC name (such as
<em>mx6</em> , <em>ti33x,</em> or <em>rk3288</em> ) with an underscore to a variable or task</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>DEPENDS:remove:mx6<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtual/libgl&quot;</span><span class="w"> </span>or
python<span class="w"> </span>do_env_append_phyboard-mira-imx6-4().
</pre></div>
</div>
<p>The next example adds the environment variables only if the MACHINE is set to
<em>phyboard-mira-imx6-4</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file meta-phytec/recipes-bsp/barebox/barebox_2022.02.0-phy1.bbappend</span>
python<span class="w"> </span>do_env:append:phyboard-mira-imx6-4()<span class="w"> </span>{
<span class="w">    </span>env_add(d,<span class="w"> </span><span class="s2">&quot;nv/linux.bootargs.cma&quot;</span>,<span class="w"> </span><span class="s2">&quot;cma=64M\n&quot;</span><span class="p">)</span>
}
</pre></div>
</div>
<p><em>Bitbake’s</em> override syntax for variables is explained in more detail at:
<a class="reference external" href="https://docs.yoctoproject.org/bitbake/2.4/bitbake-user-manual/bitbake-user-manual-metadata.html#conditional-metadata">https://docs.yoctoproject.org/bitbake/2.4/bitbake-user-manual/bitbake-user-manual-metadata.html#conditional-metadata</a></p>
</section>
<section id="upgrading-the-barebox-environment-from-previous-bsp-releases">
<h4><span class="section-number">9.6.15.3. </span>Upgrading the <em>barebox</em> Environment from Previous BSP Releases<a class="headerlink" href="#upgrading-the-barebox-environment-from-previous-bsp-releases" title="Link to this heading"></a></h4>
<p>Prior to BSP version <em>BSP-Yocto-AM335x-16.2.0</em> and <em>BSP-Yocto-i.MX6-PD16.1.0</em> ,
<em>barebox</em> environment changes via <em>bbappend</em> file were done differently. For
example, the directory structure in your meta layer (here <em>meta-skeleton</em> ) may
have looked like this</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>tree<span class="w"> </span>-a<span class="w"> </span>sources/meta-skeleton/recipes-bsp/barebox/
<span class="go">sources/meta-skeleton/recipes-bsp/barebox</span>
<span class="go">├── barebox</span>
<span class="go">│   └── phyboard-wega-am335x-3</span>
<span class="go">│       ├── boardenv</span>
<span class="go">│       │   └── .gitignore</span>
<span class="go">│       └── machineenv</span>
<span class="go">│           └── nv</span>
<span class="go">│               └── linux.bootargs.cma</span>
<span class="go">└── barebox_%.bbappend</span>
</pre></div>
</div>
<p>and the file <em>barebox_%.bbappend</em> contained</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file sources/meta-skeleton/recipes-bsp/barebox/barebox_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/barebox:&quot;</span>
</pre></div>
</div>
<p>In this example, all environment changes from the directory <em>boardenv</em> in the
layer <em>meta-phytec</em> are ignored and the file <em>nv/linux.bootargs.cma</em> is added.
For the new handling of the <em>barebox</em> environment, you use the <em>Python</em>
functions <em>env_add</em> and <em>env_rm</em> in the <em>Python</em> task <em>do_env</em>. Now the above
example translates to a single <em>Python</em> function in the file
<em>barebox_%.bbappend</em> that looks like</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file sources/meta-skeleton/recipes-bsp/barebox/barebox_%.bbappend</span>
FILESEXTRAPATHS:prepend<span class="w"> </span>:=<span class="w"> </span><span class="s2">&quot;${THISDIR}/barebox:&quot;</span>
python<span class="w"> </span>do_env:append()<span class="w"> </span>{
<span class="w">    </span><span class="c1"># Removing files (previously boardenv)</span>
<span class="w">    </span>env_rm(d,<span class="w"> </span><span class="s2">&quot;config-expansions&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># Adding new files (previously machineenv)</span>
<span class="w">    </span>env_add(d,<span class="w"> </span><span class="s2">&quot;nv/linux.bootargs.cma&quot;</span>,<span class="w"> </span><span class="s2">&quot;cma=64M\n&quot;</span><span class="p">)</span>
}
</pre></div>
</div>
</section>
</section>
<section id="changing-the-network-configuration">
<span id="scarthgap-changing-net-config"></span><h3><span class="section-number">9.6.16. </span>Changing the Network Configuration<a class="headerlink" href="#changing-the-network-configuration" title="Link to this heading"></a></h3>
<p>To tweak IP addresses, routes, and gateways at runtime you can use the
<em>iproute2</em> tools. Some examples</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>ip<span class="w"> </span>addr<span class="w">                                         </span><span class="c1"># Show all network interfaces</span>
<span class="gp">target:~$ </span>ip<span class="w"> </span>route<span class="w">                                        </span><span class="c1"># Show all routes</span>
<span class="gp">target:~$ </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.178.11/24<span class="w"> </span>dev<span class="w"> </span>eth0<span class="w">          </span><span class="c1"># Add static ip and route to interface eth0</span>
<span class="gp">target:~$ </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.178.1<span class="w"> </span>dev<span class="w"> </span>eth0<span class="w"> </span><span class="c1"># Add default gateway 192.168.178.1</span>
<span class="gp">target:~$ </span>ip<span class="w"> </span>addr<span class="w"> </span>del<span class="w"> </span><span class="m">192</span>.168.178.11/24<span class="w"> </span>dev<span class="w"> </span>eth0<span class="w">          </span><span class="c1"># Remove static ip address from interface eth0</span>
</pre></div>
</div>
<p>The network configuration is managed by <em>systemd-networkd</em> . To query the
current status use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>networkctl<span class="w"> </span>status
<span class="gp">target:~$ </span>networkctl<span class="w"> </span>list
</pre></div>
</div>
<p>The network daemon reads its configuration from the directories
<em>/etc/systemd/network/</em> , <em>/run/systemd/network/</em> , and <em>/lib/systemd/network/</em>
(from higher to lower priority). A sample configuration in
<em>/lib/systemd/network/10-eth0.network</em> looks like this</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file /lib/systemd/network/10-eth0.network</span>
[Match]
Name=eth0

[Network]
Address=192.168.3.11/24
Gateway=192.168.3.10
</pre></div>
</div>
<p>These files <em>*.network</em> replace <em>/etc/network/interfaces</em> from other
distributions. You can either edit the file <em>10-eth0.network</em> in-place or copy
it to <em>/etc/systemd/network/</em> and make your changes there. After changing a file
you must restart the daemon to apply your changes</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-networkd
</pre></div>
</div>
<p>To see the syslog message of the network daemon, use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>journalctl<span class="w"> </span>--unit<span class="o">=</span>systemd-networkd.service
</pre></div>
</div>
<p>To modify the network configuration at build time, look at the recipe
<em>sources/meta-ampliphy/recipes-core/systemd/systemd-machine-units.bb</em>
and the interface files in the folder
<em>meta-ampliphy/recipes-core/systemd/systemd-machine-units/</em> where the static IP
address configuration for <em>eth0</em> (and optionally <em>eth1</em>) is done.</p>
<p>For more information, see <a class="reference external" href="https://wiki.archlinux.org/title/Systemd-networkd">https://wiki.archlinux.org/title/Systemd-networkd</a>
and <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/latest/systemd.network.html">https://www.freedesktop.org/software/systemd/man/latest/systemd.network.html</a>.</p>
</section>
<section id="changing-the-wireless-network-configuration">
<h3><span class="section-number">9.6.17. </span>Changing the Wireless Network Configuration<a class="headerlink" href="#changing-the-wireless-network-configuration" title="Link to this heading"></a></h3>
<section id="connecting-to-a-wlan-network">
<h4><span class="section-number">9.6.17.1. </span>Connecting to a WLAN Network<a class="headerlink" href="#connecting-to-a-wlan-network" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>First set the correct regulatory domain for your country</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>iw<span class="w"> </span>reg<span class="w"> </span><span class="nb">set</span><span class="w"> </span>DE
<span class="gp">target:~$ </span>iw<span class="w"> </span>reg<span class="w"> </span>get
</pre></div>
</div>
<p>You will see</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>country DE: DFS-ETSI
   (2400 - 2483 @ 40), (N/A, 20), (N/A)
   (5150 - 5250 @ 80), (N/A, 20), (N/A), NO-OUTDOOR
   (5250 - 5350 @ 80), (N/A, 20), (0 ms), NO-OUTDOOR, DFS
   (5470 - 5725 @ 160), (N/A, 26), (0 ms), DFS
   (57000 - 66000 @ 2160), (N/A, 40), (N/A)
</pre></div>
</div>
<ul class="simple">
<li><p>Set up the wireless interface</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>ip<span class="w"> </span>link<span class="w">    </span><span class="c1"># list all interfaces. Search for wlan*</span>
<span class="gp">target:~$ </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>up<span class="w"> </span>dev<span class="w"> </span>wlan0
</pre></div>
</div>
<ul class="simple">
<li><p>Now you can scan for available networks</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>iw<span class="w"> </span>wlan0<span class="w"> </span>scan<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SSID
</pre></div>
</div>
<p>You can use a cross-platform supplicant with support for <em>WEP</em>, <em>WPA</em>, and
<em>WPA2</em> called <em>wpa_supplicant</em> for an encrypted connection.</p>
<ul class="simple">
<li><p>To do so, add the network credentials to the file
<em>/etc/wpa_supplicant.conf</em></p></li>
</ul>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>Confluence<span class="w"> </span>country=DE<span class="w"> </span>network={<span class="w"> </span>ssid=&quot;&lt;SSID&gt;&quot;<span class="w"> </span>proto=WPA2<span class="w"> </span>psk=&quot;&lt;KEY&gt;&quot;<span class="w"> </span>}
</pre></div>
</div>
<ul class="simple">
<li><p>Now a connection can be established</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>wpa_supplicant<span class="w"> </span>-Dnl80211<span class="w"> </span>-c/etc/wpa_supplicant.conf<span class="w"> </span>-iwlan0<span class="w"> </span>-B
</pre></div>
</div>
<p>This should result in the following output</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>ENT-CONNECTED<span class="w"> </span>-<span class="w"> </span>Connection<span class="w"> </span>to<span class="w"> </span><span class="mi">88</span>:33:14:5d:db:b1<span class="w"> </span>completed<span class="w"> </span>[id=0<span class="w"> </span>id_str=]
</pre></div>
</div>
<p>To finish the configuration you can configure DHCP to receive an IP address
(supported by most WLAN access points). For other possible IP configurations,
see the section <a class="reference internal" href="#scarthgap-changing-net-config"><span class="std std-ref">Changing the Network Configuration</span></a>.</p>
<ul class="simple">
<li><p>First, create the directory</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/systemd/network/
</pre></div>
</div>
<ul class="simple">
<li><p>Then add the following configuration snippet in
<em>/etc/systemd/network/10-wlan0.network</em></p></li>
</ul>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file /etc/systemd/network/10-wlan0.network</span>
[Match]
Name=wlan0

[Network]
DHCP=yes
</pre></div>
</div>
<ul class="simple">
<li><p>Now, restart the network daemon so that the configuration takes effect</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-networkd
</pre></div>
</div>
</section>
<section id="creating-a-wlan-access-point">
<h4><span class="section-number">9.6.17.2. </span>Creating a WLAN Access Point<a class="headerlink" href="#creating-a-wlan-access-point" title="Link to this heading"></a></h4>
<p>This section provides a basic access point (AP) configuration for a
secured <em>WPA2</em> network.</p>
<p>Find the name of the WLAN interface with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>ip<span class="w"> </span>link
</pre></div>
</div>
<p>Edit the configuration in <em>/etc/hostapd.conf</em>. It is strongly dependent on
the use case. The following shows an example</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file /etc/hostapd.conf</span>
interface=wlan0
driver=nl80211
ieee80211d=1
country_code=DE
hw_mode=g
ieee80211n=1
ssid=Test-Wifi
channel=2
wpa=2
wpa_passphrase=12345678
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
</pre></div>
</div>
<p>Set up and start the DHCP server for the network interface <em>wlan0</em> via
<em>systemd-networkd</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/systemd/network/
<span class="gp">target:~$ </span>vi<span class="w"> </span>/etc/systemd/network/10-wlan0.network
</pre></div>
</div>
<p>Insert the following text into the file</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>[Match]
Name=wlan0

[Network]
Address=192.168.0.1/24
DHCPServer=yes

[DHCPServer]
EmitDNS=yes
target:~$<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-networkd
target:~$<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w">  </span>systemd-networkd<span class="w"> </span>-l<span class="w">   </span><span class="c1"># check status and see errors</span>
</pre></div>
</div>
<p>Start the userspace daemon <em>hostapd</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>start<span class="w"> </span>hostapd
<span class="gp">target:~$ </span>systemctl<span class="w"> </span>status<span class="w"> </span>hostapd<span class="w"> </span>-l<span class="w"> </span><span class="c1"># check for errors</span>
</pre></div>
</div>
<p>Now, you should see the WLAN network <em>Test-Wifi</em> on your terminal device
(laptop, smartphone, etc.).</p>
<p>If there are problems with the access point, you can either check the log
messages with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>journalctl<span class="w"> </span>--unit<span class="o">=</span>hostapd
</pre></div>
</div>
<p>or start the daemon in debugging mode from the command line</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">target:~$ </span>systemctl<span class="w"> </span>stop<span class="w"> </span>hostapd
<span class="gp">target:~$ </span>hostapd<span class="w"> </span>-d<span class="w"> </span>/etc/hostapd.conf<span class="w"> </span>-P<span class="w"> </span>/var/run/hostapd.pid
</pre></div>
</div>
<p>You should see</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
wlan0: interface state UNINITIALIZED-&gt;ENABLED
wlan0: AP-ENABLED
</pre></div>
</div>
<p>Further information about AP settings and the userspace daemon
<em>hostapd</em> can be found at</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>https://wireless.wiki.kernel.org/en/users/documentation/hostapd
https://w1.fi/hostapd/
</pre></div>
</div>
</section>
<section id="phycore-i-mx-6ul-ull-bluetooth">
<h4><span class="section-number">9.6.17.3. </span>phyCORE-i.MX 6UL/ULL Bluetooth<a class="headerlink" href="#phycore-i-mx-6ul-ull-bluetooth" title="Link to this heading"></a></h4>
<p>Special consideration must be paid when working with any Bluetooth on a
phyCORE-i.MX 6UL/ULL. For further information, please check <a class="reference external" href="https://www.phytec.de/cdocuments/?doc=xoJEEQ#L844e-A5i-MX6ULULLBSPManual-Bluetooth">L-844e.A5 i.MX
6UL/ULL BSP Manual - Bluetooth</a>.</p>
</section>
</section>
<section id="add-opencv-libraries-and-examples">
<h3><span class="section-number">9.6.18. </span>Add OpenCV Libraries and Examples<a class="headerlink" href="#add-opencv-libraries-and-examples" title="Link to this heading"></a></h3>
<p><em>OpenCV</em> (Opensource Computer Vision <a class="reference external" href="https://opencv.org/">https://opencv.org/</a>) is an open-source
library for computer vision applications.</p>
<p>To install the libraries and examples edit the file <em>conf/local.conf</em> in the
<em>Yocto</em> build system and add</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file conf/local.conf</span>
<span class="c1"># Installing OpenCV libraries and examples</span>
LICENSE_FLAGS_ACCEPTED<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;commercial_libav&quot;</span>
LICENSE_FLAGS_ACCEPTED<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;commercial_x264&quot;</span>
IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; \</span>
<span class="s2">    opencv \</span>
<span class="s2">    opencv-samples \</span>
<span class="s2">    libopencv-calib3d2.4 \</span>
<span class="s2">    libopencv-contrib2.4 \</span>
<span class="s2">    libopencv-core2.4 \</span>
<span class="s2">    libopencv-flann2.4 \</span>
<span class="s2">    libopencv-gpu2.4 \</span>
<span class="s2">    libopencv-highgui2.4 \</span>
<span class="s2">    libopencv-imgproc2.4 \</span>
<span class="s2">    libopencv-legacy2.4 \</span>
<span class="s2">    libopencv-ml2.4 \</span>
<span class="s2">    libopencv-nonfree2.4 \</span>
<span class="s2">    libopencv-objdetect2.4 \</span>
<span class="s2">    libopencv-ocl2.4 \</span>
<span class="s2">    libopencv-photo2.4 \</span>
<span class="s2">    libopencv-stitching2.4 \</span>
<span class="s2">    libopencv-superres2.4 \</span>
<span class="s2">    libopencv-video2.4 \</span>
<span class="s2">    libopencv-videostab2.4 \</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
<p>Then rebuild your image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-qt6demo-image
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most examples do not work out of the box, because they depend on the <em>GTK</em>
graphics library. The BSP only supports <em>Qt6</em> .</p>
</div>
</section>
<section id="add-minimal-php-web-runtime-with-lightpd">
<h3><span class="section-number">9.6.19. </span>Add Minimal PHP web runtime with <em>lightpd</em><a class="headerlink" href="#add-minimal-php-web-runtime-with-lightpd" title="Link to this heading"></a></h3>
<p>This is one example of how to add a small runtime for PHP applications and a web
server on your target. Lighttpd can be used together with the PHP command line
tool over cgi. This solution weights only 5.5 MiB of disk storage. It is already
preconfigured in meta-ampliphy. Just modify the build configuration to install
it on the image</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># file conf/local.conf</span>
<span class="c1"># install lighttpd with php cgi module</span>
IMAGE_INSTALL:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; lighttpd&quot;</span>
</pre></div>
</div>
<p>After booting the image, you should find the example web content in <em>/www/pages</em>
. For testing php, you can delete the <em>index.html</em> and replace it with a
<em>index.php</em> file</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PHP-Test<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="cp">&lt;?php phpinfo(); ?&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>On your host, you can point your browser to the board’s IP, (e.g. 192.168.3.11)
and the phpinfo should show up.</p>
</section>
</section>
<section id="common-tasks">
<h2><span class="section-number">9.7. </span>Common Tasks<a class="headerlink" href="#common-tasks" title="Link to this heading"></a></h2>
<section id="debugging-a-user-space-application">
<h3><span class="section-number">9.7.1. </span>Debugging a User Space Application<a class="headerlink" href="#debugging-a-user-space-application" title="Link to this heading"></a></h3>
<p>The phytec-qt6demo-image can be cross-debugged without any change. For
cross-debugging, you just have to match the host sysroot with the image in use.
So you need to create a toolchain for your image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>populate_sdk<span class="w"> </span>phytec-qt6demo-image
</pre></div>
</div>
<p>Additionally, if you want to have full debug and backtrace capabilities for all
programs and libraries in the image, you could add</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>DEBUG_BUILD<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>to the <code class="docutils literal notranslate"><span class="pre">conf/local.conf</span></code>. This is not necessary in all cases. The compiler
options will then be switched from FULL_OPTIMIZATION to DEBUG_OPTIMIZATION. Look
at the <em>Poky</em> source code for the default assignment of DEBUG_OPTIMIZATION.</p>
<p>To start a cross debug session, install the SDK as mentioned previously, source
the SDK environment, and run <em>Qt Creator</em> in the same shell. If you do not use
<em>Qt Creator</em>, you can directly call the arm-&lt;..&gt;-gdb debugger instead which
should be in your path after sourcing the environment script.</p>
<p>If you work with <em>Qt Creator</em>, have a look at the appropriate documentation
delivered with your product (either QuickStart or Application Guide) for
information on how to set up the toolchain.</p>
<p>When starting the debugger with your userspace application you will get a
SIGILL, an illegal instruction from the <em>libcrypto</em>. <em>Openssl</em> probes for the
system capabilities by trapping illegal instructions, which will trigger <em>GDB</em>.
You can ignore this and hit <strong>Continue</strong> (c command). You can permanently ignore
this stop by adding</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>handle<span class="w"> </span>SIGILL<span class="w"> </span>nostop
</pre></div>
</div>
<p>to your <em>GDB</em> startup script or in the <em>Qt Creator GDB</em> configuration panel.
Secondly, you might need to disable a security feature by adding</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>set<span class="w"> </span>auto-load<span class="w"> </span>safe-path<span class="w"> </span>/
</pre></div>
</div>
<p>to the same startup script, which will enable the automatic loading of libraries
from any location.</p>
<p>If you need to have native debugging, you might want to install the debug
symbols on the target. You can do this by adding the following line to your
<em>conf/local.conf</em></p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>EXTRA_IMAGE_FEATURES<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;dbg-pkgs&quot;</span>
</pre></div>
</div>
<p>For cross-debugging, this is not required as the debug symbols will be loaded
from the host side and the dbg-pkgs are included in the SDK of your image
anyway.</p>
</section>
<section id="generating-source-mirrors-working-offline">
<span id="scarthgap-gen-source-mirrors"></span><h3><span class="section-number">9.7.2. </span>Generating Source Mirrors, working Offline<a class="headerlink" href="#generating-source-mirrors-working-offline" title="Link to this heading"></a></h3>
<p>Modify your <em>site.conf</em> (or <em>local.conf</em> if you do not use a <em>site.conf</em> ) as
follows</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1">#DL_DIR ?= &quot;&quot; don&#39;t set it! It will default to a directory inside /build</span>
SOURCE_MIRROR_URL<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;file:///home/share/yocto_downloads/&quot;</span>
INHERIT<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;own-mirrors&quot;</span>
BB_GENERATE_MIRROR_TARBALLS<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>Now run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>--runall<span class="o">=</span>fetch<span class="w"> </span>&lt;image&gt;
</pre></div>
</div>
<p>for all images and for all machines you want to provide sources for. This will
create all the necessary <em>tar</em> archives. We can remove all SCM subfolders, as
they are duplicated with the tarballs</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>rm<span class="w"> </span>-rf<span class="w"> </span>build/download/git2/
<span class="go">etc...</span>
</pre></div>
</div>
<p>Please consider that we used a local source mirror for generating the dl_dir.
Because of that, some archives will be linked locally.</p>
<p>First, we need to copy all files, resolving symbolic links into the new mirror
directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>rsync<span class="w"> </span>-vaL<span class="w"> </span>&lt;dl_dir&gt;<span class="w"> </span><span class="si">${</span><span class="nv">TOPDIR</span><span class="si">}</span>/../src_mirror/
</pre></div>
</div>
<p>Now we clean the <em>/build</em> directory by deleting everything except <em>/build/conf/</em>
but including <em>/build/conf/sanity</em>. We change <em>site.conf</em> as follows</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>SOURCE_MIRROR_URL<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;file://${TOPDIR}/../src_mirror&quot;</span>
INHERIT<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;own-mirrors&quot;</span>
BB_NO_NETWORK<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
SCONF_VERSION<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</pre></div>
</div>
<p>The BSP directory can now be compressed with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>tar<span class="w"> </span>cfJ<span class="w"> </span>&lt;filename&gt;.tar.xz<span class="w"> </span>&lt;folder&gt;
</pre></div>
</div>
<p>where filename and folder should be the full BSP Name.</p>
</section>
<section id="compiling-on-the-target">
<h3><span class="section-number">9.7.3. </span>Compiling on the Target<a class="headerlink" href="#compiling-on-the-target" title="Link to this heading"></a></h3>
<p>To your <em>local.conf</em> add</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>IMAGE_FEATURES:append<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; tools-sdk dev-pkgs&quot;</span>
</pre></div>
</div>
</section>
<section id="different-toolchains">
<h3><span class="section-number">9.7.4. </span>Different Toolchains<a class="headerlink" href="#different-toolchains" title="Link to this heading"></a></h3>
<p>There are several ways to create a toolchain installer in <em>Poky</em>. One option is
to run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>meta-toolchain
</pre></div>
</div>
<p>This will generate a toolchain installer in <em>build/deploy/sdk</em> which can be used
for cross-compiling of target applications. However, the installer does not
include libraries added to your image, so it is a bare <em>GCC</em> compiler only. This
is suited for bootloader and kernel development.</p>
<p>Another you can run is</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>populate_sdk<span class="w"> </span>&lt;your_image&gt;
</pre></div>
</div>
<p>This will generate a toolchain installer containing all necessary development
packages of the software installed on the root filesystem of the target. This
installer can be handed over to the user space application development team and
includes all necessary parts to develop an application. If the image contains
the <em>QT</em> libraries, all of those will be available in the installer too.</p>
<p>The third option is to create the ADT (Application Development Toolkit)
installer. It will contain the cross-toolchain and some tools to aid the
software developers, for example, an <em>Eclipse</em> plugin and a <em>QEMU</em> target
simulator.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>adt-installer
</pre></div>
</div>
<p>The ADT is untested for our BSP at the moment.</p>
<section id="using-the-sdk">
<h4><span class="section-number">9.7.4.1. </span>Using the SDK<a class="headerlink" href="#using-the-sdk" title="Link to this heading"></a></h4>
<p>After generating the SDK with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>sources/poky/oe-init-build-env
<span class="gp">host:~$ </span>bitbake<span class="w"> </span>-c<span class="w"> </span>populate_sdk<span class="w"> </span>phytec-qt6demo-image<span class="w"> </span><span class="c1"># or another image</span>
</pre></div>
</div>
<p>run the generated binary with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>deploy/sdk/ampliphy-glibc-x86_64-phytec-qt6demo-image-cortexa9hf-vfp-neon-toolchain-i.MX6-PD15.3-rc.sh
<span class="go">Enter target directory for SDK (default: /opt/ampliphy/i.MX6-PD15.3-rc):</span>
<span class="go">You are about to install the SDK to &quot;/opt/ampliphy/i.MX6-PD15.3-rc&quot;. Proceed[Y/n]?</span>
<span class="go">Extracting SDK...done</span>
<span class="go">Setting it up...done</span>
<span class="go">SDK has been successfully set up and is ready to be used.</span>
</pre></div>
</div>
<p>You can activate the toolchain for your shell by sourcing the file
<em>environment-setup</em> in the toolchain directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>/opt/ampliphy/i.MX6-PD15.3-rc/environment-setup-cortexa9hf-vfp-neon-phytec-linux-gnueabi
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be able to build a Qt6 application with the SDK and the Meson Build system, the following has to be done, <em>after</em> the SDK has been sourced:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$OECORE_NATIVE_SYSROOT</span>/usr/libexec:<span class="nv">$PATH</span>
</pre></div>
</div>
</div>
<p>Then the necessary tools like the cross compiler and linker are in your PATH. To
compile a simple <em>C</em> program, use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ $</span>CC<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main
</pre></div>
</div>
<p>The environment variable $CC contains the path to the ARM cross compiler and
other compiler arguments needed like <em>-march</em> , <em>-sysroot</em> and <em>–mfloat-abi</em>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You cannot compile programs only with the compiler name like</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>arm-phytec-linux-gnueabi-gcc<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>main
</pre></div>
</div>
<p>It will fail in many cases. Always use <em>CC</em>, CFLAGS, LDFLAGS, and so on.</p>
</div>
<p>For convenience, the <em>environment-setup</em> exports other environment variables
like CXX, LD, SDKTARGETSYSROOT.</p>
<p>A simple makefile compiling a <em>C</em> and <em>C++</em> program may look like this</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="c1"># Makefile</span>
TARGETS=c-program<span class="w"> </span>cpp-program

all:<span class="w"> </span>$(TARGETS)

c-program:<span class="w"> </span>c-program.c
<span class="w">    </span>$(CC)<span class="w"> </span>$(CFLAGS)<span class="w"> </span>$(LDFLAGS)<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span>$@

cpp-program:<span class="w"> </span>cpp-program.cpp
<span class="w">    </span>$(CXX)<span class="w"> </span>$(CXXFLAGS)<span class="w"> </span>$(LDFLAGS)<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span>$@

.PHONY:<span class="w"> </span>clean
clean:
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span>$(TARGETS)
</pre></div>
</div>
<p>To compile for the target, just source the toolchain in your shell before
executing make</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ make     # </span>Compiling<span class="w"> </span>with<span class="w"> </span>host<span class="w"> </span>CC,<span class="w"> </span>CXX<span class="w"> </span><span class="k">for</span><span class="w"> </span>host<span class="w"> </span>architecture
<span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>/opt/ampliphy/i.MX6-PD15.3-rc/environment-setup-cortexa9hf-vfp-neon-phytec-linux-gnueabi
<span class="gp">host:~$ make     # </span>Compiling<span class="w"> </span>with<span class="w"> </span>target<span class="w"> </span>CC,<span class="w"> </span>CXX<span class="w"> </span><span class="k">for</span><span class="w"> </span>target<span class="w"> </span>architecture
</pre></div>
</div>
<p>If you need to specify additionally included directories in the sysroot of the
toolchain, you can use an ‘=’ sign in the <em>-I</em> argument like</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>-I=/usr/include/SDL
</pre></div>
</div>
<p><em>GCC</em> replaces it by the sysroot path (here
<em>/opt/ampliphy/i.MX6-PD15.3-rc/sysroots/cortexa9hf-vfp-neon-phytec-linux-gnueabi/</em>).
See the main page of <em>GCC</em> for more information.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The variables $CFLAGS and $CXXFLAGS contain the compiler debug flag ‘-g’ by
default. This includes debugging information in the binary and making it
bigger. Those should be removed from the production image. If you create a
<em>Bitbake</em> recipe, the default behavior is to turn on ‘-g’ too. The debugging
symbols are used in the SDK rootfs to be able to get debugging information
when invoking <em>GDB</em> from the host. Before installing the package to the
target rootfs, <em>Bitbake</em> will invoke <em>strip</em> on the program which removes the
debugging symbols. By default, they are not found nor required on the target
root filesystem</p>
</div>
</section>
<section id="using-the-sdk-with-gnu-autotools">
<h4><span class="section-number">9.7.4.2. </span>Using the SDK with GNU Autotools<a class="headerlink" href="#using-the-sdk-with-gnu-autotools" title="Link to this heading"></a></h4>
<p><em>Yocto</em> SDK is a straightforward tool for a project that uses the <em>GNU
Autotools</em>. The traditional compile steps for the host are usually</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ ./autogen.sh # </span>maybe<span class="w"> </span>not<span class="w"> </span>needed
<span class="gp">host:~$ </span>./configure
<span class="gp">host:~$ </span>make
<span class="gp">host:~$ </span>make<span class="w"> </span>install<span class="w"> </span><span class="nv">DESTDIR</span><span class="o">=</span><span class="nv">$PWD</span>/build/
</pre></div>
</div>
<p>The commands to compile for the target machine with the <em>Yocto</em> SDK are quite
similar. The following commands assume that the SDK was unpacked to the
directory <em>/opt/phytec-ampliphy/i.MX6-PD15.3.0/</em> (adapt the path as needed)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span><span class="nb">source</span><span class="w"> </span>/opt/phytec-ampliphy/i.MX6-PD15.3.0/environment-setup-cortexa9hf-vfp-neon-phytec-linux-gnueabi
<span class="gp">host:~$ ./autogen.sh  # </span>maybe<span class="w"> </span>not<span class="w"> </span>needed
<span class="gp">host:~$ ./configure $</span><span class="o">{</span>CONFIGURE_FLAGS<span class="o">}</span>
<span class="gp">host:~$ </span>make
<span class="gp">host:~$ </span>make<span class="w"> </span>install<span class="w"> </span><span class="nv">DESTDIR</span><span class="o">=</span><span class="nv">$PWD</span>/build/
</pre></div>
</div>
<p>Refer to the official <em>Yocto</em> documentation for more information:
<a class="reference external" href="https://docs.yoctoproject.org/dev/singleindex.html#autotools-based-projects">Autotools-Based Projects</a></p>
</section>
</section>
<section id="working-with-kernel-modules">
<h3><span class="section-number">9.7.5. </span>Working with Kernel Modules<a class="headerlink" href="#working-with-kernel-modules" title="Link to this heading"></a></h3>
<p>You will come to the point where you either need to set some options for a
kernel module or you want to blacklist a module. Those things are handled by
<em>udev</em> and go into <em>*.conf</em> files in</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/etc/modprobe.d/\*.conf.
</pre></div>
</div>
<p>If you want to specify an option at build time, there are three relevant
variables. If you just want to autoload a module that has no autoload
capabilities, add it to</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>KERNEL_MODULE_AUTOLOAD<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;your-module&quot;</span>
</pre></div>
</div>
<p>either in the kernel recipe or in the global variable scope. If you need to
specify options for a module, you can do so with</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>KERNEL_MODULE_AUTOLOAD<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;your-module&quot;</span>
KERNEL_MODULE_PROBECONF<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;your-module&quot;</span>
module_conf_your-module<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;options your-module parametername=parametervalue&quot;</span>
</pre></div>
</div>
<p>if you want to blacklist a module from autoloading, you can do it intuitively
with</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span>KERNEL_MODULE_AUTOLOAD<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;your-module&quot;</span>
KERNEL_MODULE_PROBECONF<span class="w"> </span>+=<span class="w"> </span><span class="s2">&quot;your-module&quot;</span>
module_conf_your-module<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;blacklist your-module&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="troubleshooting">
<h1><span class="section-number">10. </span>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h1>
<section id="setscene-task-warning">
<h2><span class="section-number">10.1. </span>Setscene Task Warning<a class="headerlink" href="#setscene-task-warning" title="Link to this heading"></a></h2>
<p>This warning occurs when the Yocto cache is in a dirty state.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WARNING: Setscene task X ([...]) failed with exit code &#39;1&#39; - real task
</pre></div>
</div>
<p>You should avoid canceling the build process or if you have to, press Ctrl-C
once and wait until the build process has stopped. To remove all these warnings
just clean the sstate cache and remove the build folders.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>bitbake<span class="w"> </span>phytec-headless-image<span class="w"> </span>-c<span class="w"> </span>cleansstate<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>tmp<span class="w"> </span>deploy/ipk
</pre></div>
</div>
</section>
</section>
<section id="yocto-documentation">
<h1><span class="section-number">11. </span>Yocto Documentation<a class="headerlink" href="#yocto-documentation" title="Link to this heading"></a></h1>
<p>The most important piece of documentation for a BSP user is probably the
developer <a class="reference external" href="https://docs.yoctoproject.org/dev/dev-manual/index.html">manual</a>.</p>
<p>The chapter about common tasks is a good starting point. <a class="reference external" href="https://docs.yoctoproject.org/dev/dev-manual/layers.html#understanding-and-creating-layers">Creating Layers</a></p>
<p>The complete documentation is available on one single <a class="reference external" href="https://docs.yoctoproject.org/dev/singleindex.html">megamanual</a> HTML page,
which is good for searching for a feature or a variable name.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mickledore.html" class="btn btn-neutral float-left" title="1. PHYTEC Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../rauc/manual-index.html" class="btn btn-neutral float-right" title="RAUC Update &amp; Device Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, PHYTEC Messtechnik GmbH.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Languages
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Languages</dt>
        
          <dd><a href="https://phytec.github.io/doc-bsp-yocto/index.html">en</a></dd>
        
          <dd><a href="https://phytec.github.io/doc-bsp-yocto/zh_CN/index.html">zh_CN</a></dd>
        
    </dl>
    

    <div style="margin: 10px 0;"></div>
    <dl>
      <dt>Version</dt>
      <dd>imx95-alpha1-94-gf791886</dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>